<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Trang Tu Tập Nâng Cấp</title>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Google Fonts - Inter for a modern look -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <!-- Font cho thanh điều hướng -->
  <link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:wght@700&amp;display=swap" rel="stylesheet">
  <style>
    /* Custom selection style */
    ::selection {
      background: gold;
      color: black;
    }

    /* Active state for Table of Contents links */
    .toc-active {
      font-weight: bold;
      color: #f59e0b; /* Tailwind yellow-500 */
    }

    /* Rain heart animation for like button */
    .rain-heart {
      position: absolute;
      animation: fall 1s ease-out forwards;
      pointer-events: none; /* Allow clicks to pass through */
      z-index: 10000; /* Ensure hearts are on top */
    }

    @keyframes fall {
      0% {
        opacity: 1;
        transform: translateY(-10px) scale(1);
      }
      100% {
        opacity: 0;
        transform: translateY(100px) scale(0.5);
      }
    }

    /* Highlight for search functionality */
    .highlight {
      background-color: yellow;
      padding: 2px 0;
    }

    /* Highlight for current reading paragraph */
    .highlight-paragraph {
      background-color: #fffacd; /* Light yellow for highlighting */
      transition: background-color 0.3s ease;
      padding: 0.25em 0.5em; /* Add some padding for better visual */
      border-radius: 0.25em; /* Rounded corners for highlight */
      display: block; /* Ensure it takes full width */
    }

    /* Dark mode adjustment for highlight */
    body.dark .highlight-paragraph {
      background-color: #3a3f4a; /* Darker shade for contrast in dark mode */
    }

    /* Smooth scroll behavior */
    html {
      scroll-behavior: smooth;
    }

    /* Apply Inter font globally */
    body {
      font-family: 'Inter', sans-serif;
      background-color: #fdfbf7;
      background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23d4af37' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
      color: #3d4451;
    }
    .card {
        background-color: rgba(255, 255, 255, 0.85);
        backdrop-filter: blur(10px);
        -webkit-backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
    }
    .text-title { color: #8C5B00; }
    .text-body { color: #3d4451; }
    .text-quote { color: #a16207; }
    .border-accent { border-color: #eab308; }
    .bg-accent-light { background-color: #fefce8; }

    /* Dark mode styles (applied on top of themes) */
    body.dark {
      background-color: #1a202c; /* Tailwind gray-900 */
      color: #e2e8f0; /* Tailwind gray-200 */
    }

    body.dark .bg-white {
      background-color: #2d3748; /* Tailwind gray-800 */
    }

    body.dark .text-gray-900 {
      color: #e2e8f0;
    }

    body.dark .bg-yellow-200 {
      background-color: #4a5568; /* Tailwind gray-700 */
    }
    body.dark .text-yellow-900 {
      color: #f6e05e; /* Tailwind yellow-300 */
    }
    
    body.dark .bg-gray-50 { /* Adjust for dark mode TOC */
      background-color: #2d3748;
    }

    body.dark .bg-gray-200 {
      background-color: #4a5568;
      color: #e2e8f0;
    }

    body.dark .bg-gray-300 {
      background-color: #6a7382;
    }

    body.dark #shareModal > div {
      background-color: #2d3748;
    }

    /* --- Define CSS Variables for Dynamic Theming --- */
    :root {
      /* Existing variables */
      --main-border-color: #f59e0b; /* Default: yellow-500 */
      --glowing-shadow-color: rgba(252, 211, 77, 0.4); /* Default: yellow-300 with alpha */
      --content-bg-color: #ffffff; /* Default: white */
      --content-text-color: #1f2937; /* Default: gray-900 */
      --header-bg-color: #fef08a; /* Default: yellow-200 */
      --header-text-color: #92400e; /* Default: yellow-900 */
      --toc-bg-color: #f9fafb; /* Default: gray-50 */
      --button-bg-blue: #2563eb; /* Default: blue-600 */
      --button-hover-blue: #1d4ed8; /* Default: blue-700 */
      --button-bg-pink: #ec4899; /* Default: pink-500 */
      --button-hover-pink: #db2777; /* Default: pink-600 */
      --button-bg-gray: #e5e7eb; /* Default: gray-200 */
      --button-hover-gray: #d1d5db; /* Default: gray-300 */
      --button-text-gray: #1f2937; /* Default: gray-800 */
      --button-bg-green: #22c55e; /* Default: green-500 */
      --button-hover-green: #16a34a; /* Default: green-600 */
      --button-bg-dark: #374151; /* Default: gray-700 */
      --button-hover-dark: #1f2937; /* Default: gray-800 */
      --input-border-color: #d1d5db; /* Default: gray-300 */
      --input-focus-ring: #f59e0b; /* Default: yellow-500 */

      /* New variables for sophisticated styling */
      --divider-color: #cbd5e0; /* gray-300 */
      --divider-icon-color: #f59e0b; /* yellow-500 */

      --summary-bg-color: #fffbeb; /* yellow-50 */
      --summary-border-color: #fcd34d; /* yellow-300 */
      --summary-text-color: #4b5563; /* gray-700 */
      --summary-shadow-color: rgba(251, 191, 36, 0.2); /* yellow-500 with alpha */

      --blockquote-bg-color: #f9fafb; /* gray-50 */
      --blockquote-border-color: #f59e0b; /* yellow-500 */
      --blockquote-text-color: #374151; /* gray-700 */
      --blockquote-icon-color: #f59e0b; /* yellow-500 */

      --list-bullet-color: #f59e0b; /* yellow-500 */

      /* New variables for teaching emphasis */
      --content-heading-color: #8b5cf6; /* purple-500 */
      --strong-emphasis-color: #ef4444; /* red-500 */
      --note-text-color: #10b981; /* green-600 */
      --note-bg-color: #ecfdf5; /* green-50 */
      --farewell-text-color: #dc2626; /* red-600 */

      /* New variables for note and quote boxes */
      --note-box-bg: #fef2f2; /* red-50 */
      --note-box-border-left: #ef4444; /* red-500 */
      --note-box-text-color: #7f1d1d; /* red-900 */
      --note-box-heading-color: #b91c1c; /* red-700 */

      --quote-box-bg: #fffbeb; /* yellow-50 */
      --quote-box-border-left: #f59e0b; /* yellow-500 */
      --quote-box-text-color: #4b5563; /* gray-700 */
      --quote-box-heading-color: #d97706; /* amber-700 */

      /* New variable for main title color */
      --main-title-color: #a0522d; /* Sienna - default for main title */

      /* New nav bar colors */
      --nav-bg: rgba(253, 251, 247, 0.85);
      --nav-logo-shadow: rgba(0,0,0,0.1);
      --nav-logo-fallback-bg: #fdfbf7;
      --nav-logo-fallback-text: #8C5B00;
      --nav-button-bg: #000;
      --nav-button-text: #fff;
      --nav-button-border: rgba(255, 255, 255, 0.15);
      --nav-button-shadow-purple: rgba(172, 92, 232, 0.5);
      --nav-button-shadow-inner: rgba(0, 0, 0, 0.8);
      --nav-button-glow-red: rgba(255, 31, 113, 0.8);
      --nav-button-glow-red-dark: #4a0e69;
      --nav-button-glow-red-shadow: rgba(255, 31, 113, 0.7);
      --nav-button-glow-blue: rgba(0, 191, 255, 0.7);
      --nav-button-glow-blue-dark: #004d66;
      --nav-button-glow-blue-shadow: rgba(0, 191, 255, 0.6);
      --nav-mobile-menu-bg: rgba(253, 251, 247, 0.95); /* Lighter for mobile menu */
      --nav-mobile-menu-text: #3d4451;

      /* Like button specific glow colors */
      --like-button-glow-color: rgba(236, 72, 153, 0.8); /* pink-500 with alpha */
      --like-button-glow-dark: #881337; /* Darker pink/red */
      --like-button-glow-shadow: rgba(236, 72, 153, 0.7);
    }

    /* Dark mode variables */
    body.dark {
      /* Existing variables */
      --main-border-color: #fcd34d;
      --glowing-shadow-color: rgba(251, 191, 36, 0.3);
      --content-bg-color: #2d3748;
      --content-text-color: #e2e8f0;
      --header-bg-color: #4a5568;
      --header-text-color: #f6e05e;
      --toc-bg-color: #2d3748;
      --button-bg-blue: #3b82f6;
      --button-hover-blue: #2563eb;
      --button-bg-pink: #fb7185;
      --button-hover-pink: #f43f5e;
      --button-bg-gray: #4a5568;
      --button-hover-gray: #6a7382;
      --button-text-gray: #e2e8f0;
      --button-bg-green: #34d399;
      --button-hover-green: #10b981;
      --button-bg-dark: #e2e8f0;
      --button-hover-dark: #cbd5e0;
      --input-border-color: #4a5568;
      --input-focus-ring: #f6e05e;

      /* New variables for dark mode */
      --divider-color: #4a5568; /* gray-700 */
      --divider-icon-color: #f6e05e; /* yellow-300 */

      --summary-bg-color: #1f2937; /* gray-900 */
      --summary-border-color: #f6e05e; /* yellow-300 */
      --summary-text-color: #e2e8f0; /* gray-200 */
      --summary-shadow-color: rgba(251, 191, 36, 0.1); /* yellow-500 with alpha */

      --blockquote-bg-color: #1a202c; /* gray-900 */
      --blockquote-border-color: #f6e05e; /* yellow-300 */
      --blockquote-text-color: #e2e8f0; /* gray-200 */
      --blockquote-icon-color: #f6e05e; /* yellow-300 */

      --list-bullet-color: #f6e05e; /* yellow-300 */

      /* New variables for teaching emphasis in dark mode */
      --content-heading-color: #c4b5fd; /* purple-300 */
      --strong-emphasis-color: #f87171; /* red-400 */
      --note-text-color: #6ee7b7; /* green-300 */
      --note-bg-color: #064e3b; /* green-900 */
      --farewell-text-color: #ef4444; /* red-500 */

      /* New variables for note and quote boxes in dark mode */
      --note-box-bg: #450a0a; /* red-950 */
      --note-box-border-left: #dc2626; /* red-600 */
      --note-box-text-color: #fca5a5; /* red-300 */
      --note-box-heading-color: #ef4444; /* red-500 */

      --quote-box-bg: #2d3748; /* gray-800 */
      --quote-box-border-left: #fcd34d; /* yellow-300 */
      --quote-box-text-color: #e2e8f0; /* gray-200 */
      --quote-box-heading-color: #fcd34d; /* yellow-300 */

      /* New variable for main title color in dark mode */
      --main-title-color: #fcd34d; /* yellow-300 - dark mode main title */

      /* New nav bar colors for dark mode */
      --nav-bg: rgba(26, 32, 44, 0.85); /* Darker for dark mode */
      --nav-logo-shadow: rgba(255,255,255,0.1);
      --nav-logo-fallback-bg: #1a202c;
      --nav-logo-fallback-text: #f6e05e;
      --nav-button-bg: #e2e8f0; /* Light text on dark background */
      --nav-button-text: #1a202c; /* Dark text on light button */
      --nav-button-border: rgba(255, 255, 255, 0.3);
      --nav-button-shadow-purple: rgba(172, 92, 232, 0.5);
      --nav-button-shadow-inner: rgba(255, 255, 255, 0.2);
      --nav-button-glow-red: rgba(255, 31, 113, 0.8);
      --nav-button-glow-red-dark: #881337;
      --nav-button-glow-red-shadow: rgba(255, 31, 113, 0.7);
      --nav-button-glow-blue: rgba(0, 191, 255, 0.7);
      --nav-button-glow-blue-dark: #0083b3;
      --nav-button-glow-blue-shadow: rgba(0, 191, 255, 0.6);
      --nav-mobile-menu-bg: rgba(26, 32, 44, 0.95);
      --nav-mobile-menu-text: #e2e8f0;

      /* Like button specific glow colors for dark mode */
      --like-button-glow-color: rgba(251, 113, 133, 0.8); /* pink-400 with alpha for dark mode */
      --like-button-glow-dark: #881337; /* Consistent dark pink/red */
      --like-button-glow-shadow: rgba(251, 113, 133, 0.7);
    }

    /* Xanh Lục Tĩnh Lặng */
    body.theme-green {
      /* Existing variables */
      --main-border-color: #48bb78;
      --glowing-shadow-color: rgba(76, 209, 140, 0.3);
      --content-bg-color: #d4f0f0;
      --content-text-color: #2f4f4f;
      --header-bg-color: #a7d9d9;
      --header-text-color: #2f4f4f;
      --toc-bg-color: #c0e0e0;
      --button-bg-blue: #6495ed;
      --button-hover-blue: #4169e1;
      --button-bg-pink: #ffb6c1;
      --button-hover-pink: #ff8c9a;
      --button-bg-gray: #80ced6;
      --button-hover-gray: #66b2b2;
      --button-text-gray: #2f4f4f;
      --button-bg-green: #3cb371;
      --button-hover-green: #2e8b57;
      --button-bg-dark: #5f9ea0;
      --button-hover-dark: #4682b4;
      --input-border-color: #80ced6;
      --input-focus-ring: #48bb78;

      /* New variables for green theme */
      --divider-color: #80ced6;
      --divider-icon-color: #48bb78;

      --summary-bg-color: #e0f8f8;
      --summary-border-color: #66b2b2;
      --summary-text-color: #2f4f4f;
      --summary-shadow-color: rgba(72, 187, 120, 0.2);

      --blockquote-bg-color: #e6f7f7;
      --blockquote-border-color: #48bb78;
      --blockquote-text-color: #2f4f4f;
      --blockquote-icon-color: #48bb78;

      --list-bullet-color: #48bb78;

      /* New variables for teaching emphasis in green theme */
      --content-heading-color: #2e8b57; /* SeaGreen */
      --strong-emphasis-color: #b22222; /* FireBrick */
      --note-text-color: #006400; /* DarkGreen */
      --note-bg-color: #d4edda; /* Light green */
      --farewell-text-color: #8b0000; /* DarkRed */

      /* New variables for note and quote boxes in green theme */
      --note-box-bg: #ffebee; /* red-50 equivalent for green theme */
      --note-box-border-left: #ef5350; /* red-400 equivalent for green theme */
      --note-box-text-color: #c62828; /* red-700 equivalent for green theme */
      --note-box-heading-color: #b71c1c; /* red-800 equivalent for green theme */

      --quote-box-bg: #e8f5e9; /* green-50 */
      --quote-box-border-left: #4caf50; /* green-500 */
      --quote-box-text-color: #1b5e20; /* green-900 */
      --quote-box-heading-color: #388e3c; /* green-700 */

      /* New variable for main title color in green theme */
      --main-title-color: #1b5e20; /* green-900 - green theme main title */

      /* New nav bar colors for green theme */
      --nav-bg: rgba(192, 224, 224, 0.85);
      --nav-logo-shadow: rgba(0,0,0,0.1);
      --nav-logo-fallback-bg: #d4f0f0;
      --nav-logo-fallback-text: #2f4f4f;
      --nav-button-bg: #2f4f4f;
      --nav-button-text: #fff;
      --nav-button-border: rgba(255, 255, 255, 0.15);
      --nav-button-shadow-purple: rgba(72, 187, 120, 0.5);
      --nav-button-shadow-inner: rgba(0, 0, 0, 0.8);
      --nav-button-glow-red: rgba(255, 31, 113, 0.8);
      --nav-button-glow-red-dark: #4a0e69;
      --nav-button-glow-red-shadow: rgba(255, 31, 113, 0.7);
      --nav-button-glow-blue: rgba(0, 191, 255, 0.7);
      --nav-button-glow-blue-dark: #004d66;
      --nav-button-glow-blue-shadow: rgba(0, 191, 255, 0.6);
      --nav-mobile-menu-bg: rgba(192, 224, 224, 0.95);
      --nav-mobile-menu-text: #2f4f4f;

      /* Like button specific glow colors for green theme */
      --like-button-glow-color: rgba(255, 182, 193, 0.8); /* Light pink for green theme */
      --like-button-glow-dark: #b22222; /* Consistent dark pink/red */
      --like-button-glow-shadow: rgba(255, 182, 193, 0.7);
    }
    body.theme-green.dark { /* Dark mode for green theme */
      /* Existing variables */
      --main-border-color: #68d391;
      --glowing-shadow-color: rgba(76, 209, 140, 0.2);
      --content-bg-color: #2d483a;
      --content-text-color: #e0f2e0;
      --header-bg-color: #3a5f4a;
      --header-text-color: #90ee90;
      --toc-bg-color: #2a3a2d;
      --button-bg-blue: #4682b4;
      --button-hover-blue: #366792;
      --button-bg-pink: #ff69b4;
      --button-hover-pink: #ff1493;
      --button-bg-gray: #3a5f4a;
      --button-hover-gray: #4a705a;
      --button-text-gray: #e0f2e0;
      --button-bg-green: #2e8b57;
      --button-hover-green: #1e6b3f;
      --button-bg-dark: #e0f2e0;
      --button-hover-dark: #c0e0c0;
      --input-border-color: #3a5f4a;
      --input-focus-ring: #68d391;

      /* New variables for green theme dark mode */
      --divider-color: #3a5f4a;
      --divider-icon-color: #90ee90;

      --summary-bg-color: #1e3028;
      --summary-border-color: #90ee90;
      --summary-text-color: #e0f2e0;
      --summary-shadow-color: rgba(144, 238, 144, 0.1);

      --blockquote-bg-color: #1a2c20;
      --blockquote-border-color: #90ee90;
      --blockquote-text-color: #e0f2e0;
      --blockquote-icon-color: #90ee90;

      --list-bullet-color: #90ee90;

      /* New variables for teaching emphasis in green theme dark mode */
      --content-heading-color: #90ee90; /* LightGreen */
      --strong-emphasis-color: #ff6347; /* Tomato */
      --note-text-color: #3cb371; /* MediumSeaGreen */
      --note-bg-color: #1a2c20; /* Darker green */
      --farewell-text-color: #ff4500; /* OrangeRed */

      /* New variables for note and quote boxes in green theme dark mode */
      --note-box-bg: #2a0000; /* Darker red */
      --note-box-border-left: #ef5350; /* Red-400 */
      --note-box-text-color: #ffcdd2; /* Red-100 */
      --note-box-heading-color: #ef9a9a; /* Red-200 */

      --quote-box-bg: #1a2c20; /* Darker green */
      --quote-box-border-left: #68d390; /* Green-400 */
      --quote-box-text-color: #e0f2e0; /* Light green */
      --quote-box-heading-color: #90ee90; /* Light green */

      /* New variable for main title color in green theme dark mode */
      --main-title-color: #90ee90; /* LightGreen - green theme dark mode main title */

      /* New nav bar colors for green theme dark mode */
      --nav-bg: rgba(45, 70, 58, 0.85);
      --nav-logo-shadow: rgba(255,255,255,0.1);
      --nav-logo-fallback-bg: #2d483a;
      --nav-logo-fallback-text: #90ee90;
      --nav-button-bg: #e0f2e0;
      --nav-button-text: #2d483a;
      --nav-button-border: rgba(255, 255, 255, 0.3);
      --nav-button-shadow-purple: rgba(144, 238, 144, 0.5);
      --nav-button-shadow-inner: rgba(255, 255, 255, 0.2);
      --nav-button-glow-red: rgba(255, 31, 113, 0.8);
      --nav-button-glow-red-dark: #881337;
      --nav-button-glow-red-shadow: rgba(255, 31, 113, 0.7);
      --nav-button-glow-blue: rgba(0, 191, 255, 0.7);
      --nav-button-glow-blue-dark: #0083b3;
      --nav-button-glow-blue-shadow: rgba(0, 191, 255, 0.6);
      --nav-mobile-menu-bg: rgba(45, 70, 58, 0.95);
      --nav-mobile-menu-text: #e0f2e0;
    }


    /* Tím Thiền Định */
    body.theme-purple {
      /* Existing variables */
      --main-border-color: #9f7aea;
      --glowing-shadow-color: rgba(164, 116, 252, 0.3);
      --content-bg-color: #e8d0f2;
      --content-text-color: #4b0082;
      --header-bg-color: #d8bfd8;
      --header-text-color: #4b0082;
      --toc-bg-color: #e6cce6;
      --button-bg-blue: #8a2be2;
      --button-hover-blue: #6a0dad;
      --button-bg-pink: #ff69b4;
      --button-hover-pink: #ff1493;
      --button-bg-gray: #b0e0e6;
      --button-hover-gray: #92c9d2;
      --button-text-gray: #4b0082;
      --button-bg-green: #8a2be2; /* Using purple for green contrast */
      --button-hover-green: #6a0dad;
      --button-bg-dark: #9370db;
      --button-hover-dark: #7b68ee;
      --input-border-color: #b0e0e6;
      --input-focus-ring: #9f7aea;

      /* New variables for purple theme */
      --divider-color: #b0e0e6;
      --divider-icon-color: #9f7aea;

      --summary-bg-color: #f2e6f9;
      --summary-border-color: #b794f4;
      --summary-text-color: #4b0082;
      --summary-shadow-color: rgba(159, 122, 234, 0.2);

      --blockquote-bg-color: #f0e6f7;
      --blockquote-border-color: #9f7aea;
      --blockquote-text-color: #4b0082;
      --blockquote-icon-color: #9f7aea;

      --list-bullet-color: #9f7aea;

      /* New variables for teaching emphasis in purple theme */
      --content-heading-color: #800080; /* Purple */
      --strong-emphasis-color: #c71585; /* MediumVioletRed */
      --note-text-color: #4b0082; /* Indigo */
      --note-bg-color: #e0b0ff; /* Plum */
      --farewell-text-color: #8b0000; /* DarkRed */

      /* New variables for note and quote boxes in purple theme */
      --note-box-bg: #fce4ec; /* pink-50 equivalent for purple theme */
      --note-box-border-left: #e91e63; /* pink-600 equivalent for purple theme */
      --note-box-text-color: #880e4f; /* pink-900 equivalent for purple theme */
      --note-box-heading-color: #c2185b; /* pink-700 equivalent for purple theme */

      --quote-box-bg: #ede7f6; /* deep purple-50 */
      --quote-box-border-left: #673ab7; /* deep purple-500 */
      --quote-box-text-color: #311b92; /* deep purple-900 */
      --quote-box-heading-color: #512da8; /* deep purple-700 */

      /* New variable for main title color in purple theme */
      --main-title-color: #4b0082; /* Indigo - purple theme main title */

      /* New nav bar colors for purple theme */
      --nav-bg: rgba(230, 204, 230, 0.85);
      --nav-logo-shadow: rgba(0,0,0,0.1);
      --nav-logo-fallback-bg: #e8d0f2;
      --nav-logo-fallback-text: #4b0082;
      --nav-button-bg: #4b0082;
      --nav-button-text: #fff;
      --nav-button-border: rgba(255, 255, 255, 0.15);
      --nav-button-shadow-purple: rgba(159, 122, 234, 0.5);
      --nav-button-shadow-inner: rgba(0, 0, 0, 0.8);
      --nav-button-glow-red: rgba(255, 31, 113, 0.8);
      --nav-button-glow-red-dark: #4a0e69;
      --nav-button-glow-red-shadow: rgba(255, 31, 113, 0.7);
      --nav-button-glow-blue: rgba(0, 191, 255, 0.7);
      --nav-button-glow-blue-dark: #004d66;
      --nav-button-glow-blue-shadow: rgba(0, 191, 255, 0.6);
      --nav-mobile-menu-bg: rgba(230, 204, 230, 0.95);
      --nav-mobile-menu-text: #4b0082;

      /* Like button specific glow colors for purple theme */
      --like-button-glow-color: rgba(255, 105, 180, 0.8); /* Hot pink for purple theme */
      --like-button-glow-dark: #b22222;
      --like-button-glow-shadow: rgba(255, 105, 180, 0.7);
    }
    body.theme-purple.dark { /* Dark mode for purple theme */
      /* Existing variables */
      --main-border-color: #b794f4;
      --glowing-shadow-color: rgba(164, 116, 252, 0.2);
      --content-bg-color: #4a3068;
      --content-text-color: #f0e6ff;
      --header-bg-color: #3a2048;
      --header-text-color: #d8bfd8;
      --toc-bg-color: #2a183a;
      --button-bg-blue: #6a0dad;
      --button-hover-blue: #480082;
      --button-bg-pink: #ff1493;
      --button-hover-pink: #c71585;
      --button-bg-gray: #3a2048;
      --button-hover-gray: #4a285a;
      --button-text-gray: #f0e6ff;
      --button-bg-green: #6a0dad;
      --button-hover-green: #480082;
      --button-bg-dark: #f0e6ff;
      --button-hover-dark: #d8cce6;
      --input-border-color: #3a2048;
      --input-focus-ring: #b794f4;

      /* New variables for purple theme dark mode */
      --divider-color: #3a2048;
      --divider-icon-color: #d8bfd8;

      --summary-bg-color: #2e183a;
      --summary-border-color: #d8bfd8;
      --summary-text-color: #f0e6ff;
      --summary-shadow-color: rgba(216, 191, 216, 0.1);

      --blockquote-bg-color: #20102a;
      --blockquote-border-color: #d8bfd8;
      --blockquote-text-color: #f0e6ff;
      --blockquote-icon-color: #d8bfd8;

      --list-bullet-color: #d8bfd8;

      /* New variables for teaching emphasis in purple theme dark mode */
      --content-heading-color: #d8bfd8; /* Thistle */
      --strong-emphasis-color: #ff69b4; /* HotPink */
      --note-text-color: #b794f4; /* Light purple */
      --note-bg-color: #20102a; /* Darker purple */
      --farewell-text-color: #ff4500; /* OrangeRed */

      /* New variables for note and quote boxes in purple theme dark mode */
      --note-box-bg: #2a0000; /* Dark red for contrast */
      --note-box-border-left: #ff4081; /* Pink A200 */
      --note-box-text-color: #ff80ab; /* Pink A100 */
      --note-box-heading-color: #f50057; /* Pink A400 */

      /* Like button specific glow colors for purple theme dark mode */
      --like-button-glow-color: rgba(255, 69, 0, 0.8); /* Orange-red for dark purple theme */
      --like-button-glow-dark: #b22222;
      --like-button-glow-shadow: rgba(255, 69, 0, 0.7);
    }

    /* Vàng Nhẹ Thoát Tục */
    body.theme-gold {
      /* Existing variables */
      --main-border-color: #d69e2e;
      --glowing-shadow-color: rgba(253, 230, 138, 0.4);
      --content-bg-color: #fff5e0;
      --content-text-color: #5a4a3a;
      --header-bg-color: #ffe4b5;
      --header-text-color: #5a4a3a;
      --toc-bg-color: #fffacd;
      --button-bg-blue: #add8e6;
      --button-hover-blue: #87ceeb;
      --button-bg-pink: #ffc0cb;
      --button-hover-pink: #ff8c9a;
      --button-bg-gray: #f0e68c;
      --button-hover-gray: #e6e6a8;
      --button-text-gray: #5a4a3a;
      --button-bg-green: #b8860b;
      --button-hover-green: #a0522d;
      --button-bg-dark: #daa520;
      --button-hover-dark: #b8860b;
      --input-border-color: #f0e68c;
      --input-focus-ring: #d69e2e;

      /* New variables for gold theme */
      --divider-color: #f0e68c;
      --divider-icon-color: #d69e2e;

      --summary-bg-color: #fffaf0;
      --summary-border-color: #fcd34d;
      --summary-text-color: #5a4a3a;
      --summary-shadow-color: rgba(214, 158, 46, 0.2);

      --blockquote-bg-color: #fffceb;
      --blockquote-border-color: #d69e2e;
      --blockquote-text-color: #5a4a3a;
      --blockquote-icon-color: #d69e2e;

      --list-bullet-color: #d69e2e;

      /* New variables for teaching emphasis in gold theme */
      --content-heading-color: #a0522d; /* Sienna */
      --strong-emphasis-color: #dc143c; /* Crimson */
      --note-text-color: #b8860b; /* DarkGoldenrod */
      --note-bg-color: #fff8dc; /* Cornsilk */
      --farewell-text-color: #8b0000; /* DarkRed */

      /* New variables for note and quote boxes in gold theme */
      --note-box-bg: #fff3e0; /* orange-50 equivalent for gold theme */
      --note-box-border-left: #ff9800; /* orange-500 equivalent for gold theme */
      --note-box-text-color: #e65100; /* orange-900 equivalent for gold theme */
      --note-box-heading-color: #ef6c00; /* orange-800 equivalent for gold theme */

      --quote-box-bg: #fffde7; /* yellow-50 */
      --quote-box-border-left: #fbc02d; /* amber-500 */
      --quote-box-text-color: #ff6f00; /* amber-900 */
      --quote-box-heading-color: #ffa000; /* amber-700 */

      /* New variable for main title color in gold theme */
      --main-title-color: #e65100; /* orange-900 - gold theme main title */

      /* New nav bar colors for gold theme */
      --nav-bg: rgba(255, 228, 181, 0.85);
      --nav-logo-shadow: rgba(0,0,0,0.1);
      --nav-logo-fallback-bg: #fff5e0;
      --nav-logo-fallback-text: #5a4a3a;
      --nav-button-bg: #5a4a3a;
      --nav-button-text: #fff;
      --nav-button-border: rgba(255, 255, 255, 0.15);
      --nav-button-shadow-purple: rgba(214, 158, 46, 0.5);
      --nav-button-shadow-inner: rgba(0, 0, 0, 0.8);
      --nav-button-glow-red: rgba(255, 31, 113, 0.8);
      --nav-button-glow-red-dark: #4a0e69;
      --nav-button-glow-red-shadow: rgba(255, 31, 113, 0.7);
      --nav-button-glow-blue: rgba(0, 191, 255, 0.7);
      --nav-button-glow-blue-dark: #004d66;
      --nav-button-glow-blue-shadow: rgba(0, 191, 255, 0.6);
      --nav-mobile-menu-bg: rgba(255, 228, 181, 0.95);
      --nav-mobile-menu-text: #5a4a3a;
    }
    body.theme-gold.dark { /* Dark mode for gold theme */
      /* Existing variables */
      --main-border-color: #f6e05e;
      --glowing-shadow-color: rgba(253, 230, 138, 0.2);
      --content-bg-color: #4a3a2d;
      --content-text-color: #fffaf0;
      --header-bg-color: #3a2d20;
      --header-text-color: #ffe4b5;
      --toc-bg-color: #2a2018;
      --button-bg-blue: #5f9ea0;
      --button-hover-blue: #4682b4;
      --button-bg-pink: #ff8c9a;
      --button-hover-pink: #ff1493;
      --button-bg-gray: #3a2d20;
      --button-hover-gray: #4a3a2d;
      --button-text-gray: #fffaf0;
      --button-bg-green: #a0522d;
      --button-hover-green: #8b4513;
      --button-bg-dark: #fffaf0;
      --button-hover-dark: #ffe4b5;
      --input-border-color: #3a2d20;
      --input-focus-ring: #f6e05e;

      /* Like button specific glow colors for gold theme dark mode */
      --like-button-glow-color: rgba(255, 165, 0, 0.8); /* Orange for dark gold theme */
      --like-button-glow-dark: #b22222;
      --like-button-glow-shadow: rgba(255, 165, 0, 0.7);
    }

    /* Apply styles to content */
    #content {
      border: 2px solid var(--main-border-color);
      border-radius: 1.5rem; /* 24px */
      box-shadow:
        inset 0 0 0 1px rgba(255, 255, 255, 0.3), /* Inner light border */
        0 10px 15px -3px rgba(0, 0, 0, 0.1), /* Near blur shadow */
        0 4px 6px -2px rgba(0, 0, 0, 0.05), /* Near blur shadow */
        0 0 20px 5px var(--glowing-shadow-color); /* Far glowing shadow */
      backdrop-filter: blur(15px); /* Glassmorphism effect */
      background-color: var(--content-bg-color); /* Use variable for background */
      color: var(--content-text-color); /* Use variable for text color */
      transition: all 0.5s ease-in-out; /* Smooth transition for theme changes */
    }

    /* Adjust prose styles for better compatibility with themes */
    #content.prose h1 {
        color: var(--main-title-color); /* Use new variable for main heading */
        line-height: 1.3; /* Adjust line height for better spacing */
    }
    #content.prose h2 {
        color: var(--content-heading-color); /* Use new variable for subheadings */
    }

    /* General button styling for consistency */
    button {
        background-color: var(--button-bg-blue); /* Default button color */
        color: white;
        padding: 0.75rem 1rem;
        border-radius: 0.5rem;
        transition: background-color 0.2s ease-in-out, transform 0.1s ease-out;
    }
    button:hover {
        transform: translateY(-1px);
    }
    button:active {
        transform: translateY(0);
    }

    /* Specific button overrides */
    #readBtn { background-color: var(--button-bg-blue); }
    #readBtn:hover { background-color: var(--button-hover-blue); }
    /* Like button specific styling */
    .like-button-style {
        background: var(--button-bg-pink); /* Use theme's pink */
        color: white; /* Always white text on pink */
        border: 2px solid var(--button-hover-pink); /* Use a slightly darker pink for border */
        box-shadow: 0 0 25px 8px var(--nav-button-shadow-purple), inset 0 0 12px var(--nav-button-shadow-inner); /* Keep general shadow */
    }

    .like-button-style::before {
        content: ''; position: absolute; top: 50%; left: 50%;
        width: 85%; height: 65%;
        background: radial-gradient(circle, var(--like-button-glow-color) 0%, var(--like-button-glow-dark) 80%);
        border-radius: 8px; z-index: -1;
        box-shadow: 0 0 18px 8px var(--like-button-glow-shadow);
        transform: translate(-50%, -50%);
        pointer-events: none;
        opacity: 0;
        transition: opacity 0.3s ease-in-out;
    }
    
    .like-button-style:hover::before {
        opacity: 1;
        animation: pulse-beat 1.2s infinite ease-in-out;
    }

    .like-button-style:hover {
        box-shadow: 0 0 45px 18px var(--nav-button-shadow-purple); /* Keep general hover shadow */
    }

    #shareBtn {
        background-color: var(--button-bg-gray);
        color: var(--button-text-gray);
    }
    #shareBtn:hover { background-color: var(--button-hover-gray); }
    #searchBtn { background-color: var(--button-bg-green); }
    #searchBtn:hover { background-color: var(--button-hover-green); }
    #darkModeToggle { background-color: var(--button-bg-dark); }
    #darkModeToggle:hover { background-color: var(--button-hover-dark); }
    #scrollTopBtn, #scrollBottomBtn {
        background-color: var(--main-border-color); /* Use main theme color for scroll buttons */
    }
    #scrollTopBtn:hover, #scrollBottomBtn:hover {
        background-color: var(--glowing-shadow-color); /* Use glowing color for hover */
    }

    /* Input and Select styling */
    input[type="text"], select {
        border-color: var(--input-border-color);
        background-color: var(--content-bg-color);
        color: var(--content-text-color);
    }
    input[type="text"]:focus, select:focus {
        border-color: var(--input-focus-ring);
        box-shadow: 0 0 0 2px var(--input-focus-ring);
    }

    /* Decorative Divider */
    .decorative-divider {
      border: none;
      height: 2px;
      background-color: var(--divider-color);
      position: relative;
      margin: 2rem auto;
      width: 80%; /* Adjust width as needed */
      border-radius: 1px;
    }

    .decorative-divider::before {
      content: '';
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      width: 24px;
      height: 24px;
      background-color: var(--content-bg-color); /* Match content background */
      border: 2px solid var(--divider-color);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1;
      /* Star SVG icon, using currentColor */
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolygon points='12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2'%3E%3C/polygon%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: center;
      background-size: 60%;
      color: var(--divider-icon-color); /* Set color for the SVG */
    }

    /* Summary Box */
    #summaryBox {
      background-color: var(--summary-bg-color);
      border: 2px solid var(--summary-border-color);
      border-radius: 1rem;
      padding: 2rem;
      margin-top: 3rem;
      margin-bottom: 2rem;
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05), 0 0 20px 5px var(--summary-shadow-color);
      color: var(--summary-text-color);
      transition: all 0.5s ease-in-out;
    }

    /* Blockquote Styling - now nested inside .teaching-quote-box */
    blockquote {
      background-color: transparent; /* Remove background, parent handles it */
      border-left: none; /* Remove border, parent handles it */
      padding: 0; /* Remove padding, parent handles it */
      margin: 1rem 0 0 0; /* Adjust margin */
      border-radius: 0;
      color: inherit; /* Inherit color from parent */
      position: relative;
      box-shadow: none;
      transition: none;
    }

    blockquote::before {
      content: '';
      position: absolute;
      top: 0; /* Adjust position relative to new parent */
      left: -2rem; /* Move icon outside the text block */
      width: 40px;
      height: 40px;
      /* Large quote icon SVG, using currentColor for fill */
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M3 21c3 0 7-10 7-15V3H3l-4 9h4zM14 21c3 0 7-10 7-15V3h-7l-4 9h4z'%3E%3C/path%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: center;
      background-size: contain;
      opacity: 0.6;
      color: var(--quote-box-heading-color); /* Use heading color for the icon */
    }

    /* List Item SVG Bullets */
    ul {
      list-style: none; /* Remove default bullets */
      padding-left: 0;
    }

    ul li {
      position: relative;
      padding-left: 1.8rem; /* Space for the custom bullet */
      margin-bottom: 0.5rem;
    }

    ul li::before {
      content: '';
      position: absolute;
      left: 0;
      top: 0.6em; /* Adjust vertical alignment */
      transform: translateY(-50%);
      width: 16px;
      height: 16px;
      /* Diamond SVG icon, using currentColor for fill */
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='currentColor'%3E%3Cpath d='M12 2L2 12l10 10 10-10z'%3E%3C/path%3E%3C/svg%3E");
      background-repeat: no-repeat;
      background-position: center;
      background-size: contain;
      color: var(--list-bullet-color); /* Set color for the SVG */
    }

    /* New styles for teaching emphasis */
    .strong-emphasis {
      font-weight: bold;
      color: var(--strong-emphasis-color);
      transition: color 0.5s ease-in-out;
    }

    /* Important Note Box (Image 1 style) */
    .important-note-box {
      background-color: var(--note-box-bg);
      border-left: 5px solid var(--note-box-border-left);
      padding: 1.5rem;
      border-radius: 0.75rem;
      margin: 2rem 0;
      color: var(--note-box-text-color);
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      transition: all 0.5s ease-in-out;
    }

    .important-note-box h3 {
      color: var(--note-box-heading-color);
      font-weight: bold;
      margin-top: 0;
      margin-bottom: 1rem;
    }

    /* Teaching Quote Box (Image 2 style) */
    .teaching-quote-box {
      background-color: var(--quote-box-bg);
      border-left: 5px solid var(--quote-box-border-left);
      padding: 1.5rem;
      border-radius: 0.75rem;
      margin: 2rem 0;
      color: var(--quote-box-text-color);
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      transition: all 0.5s ease-in-out;
    }

    .teaching-quote-box h3 {
      color: var(--quote-box-heading-color);
      font-weight: bold;
      margin-top: 0;
      margin-bottom: 1rem;
    }

    .farewell-text {
      color: var(--farewell-text-color);
      transition: color 0.5s ease-in-out;
    }

    /* --- THANH ĐIỀU HƯỚNG MỚI --- */
    .top-nav-bar {
        display: flex;
        gap: 10px;
        align-items: center;
        font-family: 'Be Vietnam Pro', sans-serif;
        text-transform: uppercase;
    }

    .nav-button-base {
        background: var(--nav-button-bg);
        color: var(--nav-button-text);
        font-weight: 700;
        height: 44px;
        padding: 0 18px;
        border-radius: 10px;
        text-decoration: none;
        transition: all 0.2s ease-in-out;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-shrink: 0;
        cursor: pointer;
        position: relative;
        overflow: hidden; /* Ensure glow doesn't overflow */
    }
    
    .nav-button-base:hover {
        transform: translateY(-3px) scale(1.05);
    }
    .nav-button-base:active {
        transform: translateY(0) scale(0.98);
    }

    .main-action-button {
        border: 2px solid var(--nav-button-border);
        box-shadow: 0 0 25px 8px var(--nav-button-shadow-purple), inset 0 0 12px var(--nav-button-shadow-inner);
    }

    .main-action-button::before {
        content: ''; position: absolute; top: 50%; left: 50%;
        width: 85%; height: 65%;
        background: radial-gradient(circle, var(--nav-button-glow-red) 0%, var(--nav-button-glow-red-dark) 80%);
        border-radius: 8px; z-index: -1;
        box-shadow: 0 0 18px 8px var(--nav-button-glow-red-shadow);
        transform: translate(-50%, -50%);
        pointer-events: none;
        opacity: 0;
        transition: opacity 0.3s ease-in-out;
    }
    
    .main-action-button:hover::before {
        opacity: 1;
        animation: pulse-beat 1.2s infinite ease-in-out;
    }

    @keyframes pulse-beat {
        0% { transform: translate(-50%, -50%) scale(0.95); box-shadow: 0 0 20px 8px var(--nav-button-glow-red-shadow); }
        70% { transform: translate(-50%, -50%) scale(1.15); box-shadow: 0 0 40px 18px var(--nav-button-glow-red); }
        100% { transform: translate(-50%, -50%) scale(0.95); box-shadow: 0 0 20px 8px var(--nav-button-glow-red-shadow); }
    }
    
    .main-action-button:hover {
        box-shadow: 0 0 45px 18px var(--nav-button-shadow-purple);
    }

    .footer-action-button {
        border: 1px solid var(--nav-button-border);
        box-shadow: 0 0 20px 7px var(--nav-button-shadow-purple), inset 0 0 10px var(--nav-button-shadow-inner);
    }

    .footer-action-button::before {
        content: ''; position: absolute; top: 50%; left: 50%;
        width: 85%; height: 65%;
        background: radial-gradient(circle, var(--nav-button-glow-blue) 0%, var(--nav-button-glow-blue-dark) 80%);
        border-radius: 8px; z-index: -1;
        box-shadow: 0 0 15px 7px var(--nav-button-glow-blue-shadow);
        transform: translate(-50%, -50%);
        pointer-events: none;
        opacity: 0;
        transition: opacity 0.3s ease-in-out;
    }
    
    .footer-action-button:hover::before {
        opacity: 1;
        animation: pulse-beat-menu 1.5s infinite ease-in-out;
    }

    @keyframes pulse-beat-menu {
        0% { transform: translate(-50%, -50%) scale(0.9); box-shadow: 0 0 15px 7px var(--nav-button-glow-blue-shadow); }
        70% { transform: translate(-50%, -50%) scale(1.1); box-shadow: 0 0 25px 12px var(--nav-button-glow-blue); }
        100% { transform: translate(-50%, -50%) scale(0.9); box-shadow: 0 0 15px 7px var(--nav-button-glow-blue-shadow); }
    }
    
    .footer-action-button:hover {
        box-shadow: 0 0 30px 12px var(--nav-button-shadow-purple);
    }

    .button-text-wrapper {
        font-size: 11px;
        z-index: 1;
        pointer-events: none;
    }

    .dropdown { position: relative; }

    .dropdown-content {
        position: absolute;
        top: calc(100% + 10px);
        right: 0;
        left: auto;
        transform: translateX(0);
        display: flex; flex-direction: row;
        align-items: center; gap: 6px;
        background: rgba(0, 0, 0, 0.8); /* Changed to rgba for blur effect */
        border: 1px solid rgba(255, 255, 255, 0.3);
        border-radius: 12px;
        padding: 8px;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        transition: opacity 0.2s ease, transform 0.2s ease;
        opacity: 0;
        pointer-events: none;
        z-index: 4;
        backdrop-filter: blur(6px);
        -webkit-backdrop-filter: blur(6px);
    }
    
    .dropdown.show .dropdown-content {
        opacity: 1;
        pointer-events: auto;
    }

    .dropdown-content a {
        display: flex; justify-content: center; align-items: center;
        width: 40px; height: 40px; border-radius: 6px;
        transition: background-color 0.2s ease, transform 0.2s ease;
    }

    .dropdown-content a img { width: 28px; height: 28px; }

    .dropdown-content a:hover {
        background-color: #374151;
        transform: scale(1.1);
    }
    
    .section-divider {
        border-top: 1px solid;
        border-image: linear-gradient(to right, transparent, rgba(212, 175, 55, 0.4), transparent) 1;
        margin-top: 2rem;
        margin-bottom: 2rem;
    }

    /* Dark mode for new nav bar colors */
    body.dark .top-nav-bar {
        font-family: 'Be Vietnam Pro', sans-serif; /* Ensure font consistency */
    }
    body.dark header {
        background-color: var(--nav-bg) !important;
    }
    body.dark header a.text-title {
        color: var(--header-text-color) !important; /* Ensure logo text color adapts */
    }
    body.dark header img {
        filter: drop-shadow(0 2px 4px var(--nav-logo-shadow));
    }
    body.dark header img[onerror*="placehold"] {
        background-color: var(--nav-logo-fallback-bg);
        color: var(--nav-logo-fallback-text);
    }
    body.dark .nav-button-base {
        background: var(--nav-button-bg);
        color: var(--nav-button-text);
        border-color: var(--nav-button-border);
    }
    body.dark .main-action-button {
        box-shadow: 0 0 25px 8px var(--nav-button-shadow-purple), inset 0 0 12px var(--nav-button-shadow-inner);
    }
    body.dark .main-action-button::before {
        background: radial-gradient(circle, var(--nav-button-glow-red) 0%, var(--nav-button-glow-red-dark) 80%);
        box-shadow: 0 0 18px 8px var(--nav-button-glow-red-shadow);
    }
    body.dark .main-action-button:hover {
        box-shadow: 0 0 45px 18px var(--nav-button-shadow-purple);
    }
    body.dark .footer-action-button {
        box-shadow: 0 0 20px 7px var(--nav-button-shadow-purple), inset 0 0 10px var(--nav-button-shadow-inner);
    }
    body.dark .footer-action-button::before {
        background: radial-gradient(circle, var(--nav-button-glow-blue) 0%, var(--nav-button-glow-blue-dark) 80%);
        box-shadow: 0 0 15px 7px var(--nav-button-glow-blue-shadow);
    }
    body.dark .footer-action-button:hover {
        box-shadow: 0 0 30px 12px var(--nav-button-shadow-purple);
    }
    body.dark .dropdown-content {
        background: rgba(0, 0, 0, 0.8); /* Keep dark for contrast */
        border: 1px solid rgba(255, 255, 255, 0.3);
    }
    body.dark .dropdown-content a:hover {
        background-color: #4a5568; /* Darker hover for dark mode */
    }
    body.dark #mobile-menu {
        background-color: var(--nav-mobile-menu-bg) !important;
        color: var(--nav-mobile-menu-text) !important;
    }
    body.dark #mobile-menu-button {
        color: var(--nav-mobile-menu-text) !important;
    }
    body.dark #mobile-menu a {
        color: var(--nav-mobile-menu-text) !important;
    }
    body.dark .text-title {
        color: var(--text-title); /* Ensure text-title adapts in content */
    }
  </style>

</head>
<body class="text-body">
  <!-- Scroll Progress Bar -->
  <div id="scrollProgress" class="fixed top-0 left-0 h-1 bg-yellow-400 z-[9999]" style="width: 0%;"></div>

  <!-- Navigation Header -->
  <header class="w-full p-4 sticky top-0 z-50 transition-all duration-300" style="background-color: var(--nav-bg); backdrop-filter: blur(10px);">
    <div class="max-w-6xl mx-auto flex justify-between items-center">
      <!-- Logo -->
      <a href="#" title="Trang Chủ">
        <img src="https://raw.githubusercontent.com/thiensutinhquang/Admin/main/icons/icon.png" alt="Logo Thiên Sứ Tịnh Quang" class="h-16 w-auto" style="filter: drop-shadow(0 2px 4px var(--nav-logo-shadow));" onerror="this.onerror=null; this.src='https://placehold.co/120x64/fdfbf7/8C5B00?text=Logo';">
      </a>
      
      <!-- Các nút điều hướng (Desktop) -->
      <div class="top-nav-bar hidden md:flex">
        <a href="https://thiensutinhquang.github.io/home/" target="_blank" rel="noopener noreferrer" class="nav-button-base footer-action-button">
          <span class="button-text-wrapper">TRANG CHỦ</span>
        </a>
        <a href="https://thiensutinhquang.github.io/PlayMusic/" target="_blank" rel="noopener noreferrer" class="nav-button-base main-action-button">
          <span class="button-text-wrapper">Play Nhạc</span>
        </a>
        <a href="https://thiensutinhquang.github.io/playtholientuc/" target="_blank" rel="noopener noreferrer" class="nav-button-base footer-action-button">
          <span class="button-text-wrapper">Kho Thơ</span>
        </a>
        <a href="https://thiensutinhquang.github.io/Playlist-YouTube/" target="_blank" rel="noopener noreferrer" class="nav-button-base footer-action-button">
          <span class="button-text-wrapper">Play Video</span>
        </a>
        <div class="dropdown" id="platforms-dropdown">
          <button class="nav-button-base footer-action-button" id="platforms-btn" aria-label="Nền tảng mạng xã hội">
            <span class="button-text-wrapper">NỀN TẢNG</span>
          </button>
          <div class="dropdown-content">
            <a href="https://www.youtube.com/@Thi%C3%AAnS%E1%BB%A9TinhQuang" target="_blank" rel="noopener noreferrer" title="YouTube" aria-label="YouTube">
              <svg class="w-7 h-7" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M19.615 3.184c-1.076-.293-2.196-.44-3.32-.44-1.124 0-2.244.147-3.32.44C11.83 3.477 10.709 3.624 9.585 3.624c-1.124 0-2.244-.147-3.32-.44C5.19 3.477 4.069 3.624 2.945 3.624c-1.124 0-2.244-.147-3.32-.44C-.43 3.477-.551 3.624-.551 3.624v16.752c0 1.124.912 2.036 2.036 2.036h19.03c1.124 0 2.036-.912 2.036-2.036V3.624c0 0-.121-.147-1.197-.44zM9.585 16.376V7.624L15.376 12l-5.791 4.376z"/></svg>
            </a>
            <a href="https://www.tiktok.com/@minhsutinhquang" target="_blank" rel="noopener noreferrer" title="TikTok" aria-label="TikTok">
              <svg class="w-7 h-7" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12.525 2.118a4.898 4.898 0 0 0-3.307 1.343c-.887.887-1.343 2.012-1.343 3.307v6.614c0 1.295.456 2.42 1.343 3.307.887.887 2.012 1.343 3.307 1.343h.001c1.295 0 2.42-.456 3.307-1.343.887-.887 1.343-2.012 1.343-3.307V8.525c0-.495.401-.896.896-.896s.896.401.896.896v5.793c0 2.227-.866 4.298-2.43 5.862-1.564 1.564-3.635 2.43-5.862 2.43h-.001c-2.227 0-4.298-.866-5.862-2.43-1.564-1.564-2.43-3.635-2.43-5.862V7.125c0-2.227.866-4.298 2.43-5.862C8.227.7 10.298.001 12.525.001h.001c.495 0 .896.401.896.896s-.401.896-.896.896z"/></svg>
            </a>
            <a href="https://www.facebook.com/phatphapnhiemmauTinhQuang" target="_blank" rel="noopener noreferrer" title="Facebook" aria-label="Facebook">
              <svg class="w-7 h-7" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M14 12V8h3V5h-3V3c0-1.621.523-2 2-2h1V0h-3C10.2 0 9 1.2 9 5v3H6v4h3v10h4V12h3z"/></svg>
            </a>
            <a href="https://t.me/Giaoly_phap_don_ngo" target="_blank" rel="noopener noreferrer" title="Telegram" aria-label="Telegram">
              <svg class="w-7 h-7" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm4.184 7.218c-.27-.27-.63-.42-1.01-.42s-.74.15-1.01.42l-3.08 3.08-1.54-1.54c-.27-.27-.63-.42-1.01-.42s-.74.15-1.01.42c-.27.27-.42.63-.42 1.01s.15.74.42 1.01l2.55 2.55c.27.27.63.42 1.01.42s.74-.15 1.01-.42l4.09-4.09c.27-.27.42-.63.42-1.01s-.15-.74-.42-1.01z"/></svg>
            </a>
            <a href="https://zalo.me/g/dukrae245" target="_blank" rel="noopener noreferrer" title="Zalo" aria-label="Zalo">
              <svg class="w-7 h-7" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm4.847 7.027c-.207-.15-.46-.226-.713-.226-.253 0-.506.076-.713.226-.207.15-.365.367-.46.618-.095.251-.12.524-.075.787.045.263.16.505.335.707.175.202.396.357.647.458.251.101.52.137.787.108.267-.029.516-.13.713-.301.197-.17.348-.39.435-.641.087-.251.104-.524.053-.787-.051-.263-.197-.505-.435-.707zm-9.694 0c-.207-.15-.46-.226-.713-.226-.253 0-.506.076-.713.226-.207.15-.365.367-.46.618-.095.251-.12.524-.075.787.045.263.16.505.335.707.175.202.396.357.647.458.251.101.52.137.787.108.267-.029.516-.13.713-.301.197-.17.348-.39.435-.641.087-.251.104-.524.053-.787-.051-.263-.197-.505-.435-.707zM12 18.5c-3.59 0-6.5-2.91-6.5-6.5 0-3.59 2.91-6.5 6.5-6.5s6.5 2.91 6.5 6.5c0 3.59-2.91 6.5-6.5 6.5z"/></svg>
            </a>
          </div>
        </div>
      </div>
        <!-- Nút menu cho di động -->
      <div class="md:hidden">
        <button id="mobile-menu-button" class="text-title p-2 rounded-md" aria-label="Mở menu di động">
          <svg class="w-8 h-8" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/></svg>
        </button>
      </div>
    </div>
    <!-- Menu di động (ẩn mặc định) -->
    <div id="mobile-menu" class="hidden md:hidden p-4 space-y-2" style="background-color: var(--nav-mobile-menu-bg); color: var(--nav-mobile-menu-text);">
      <a href="https://thiensutinhquang.github.io/home/" target="_blank" rel="noopener noreferrer" class="nav-button-base footer-action-button w-full" style="color: var(--nav-mobile-menu-text);">TRANG CHỦ</a>
      <a href="https://thiensutinhquang.github.io/PlayMusic/" target="_blank" rel="noopener noreferrer" class="nav-button-base main-action-button w-full" style="color: var(--nav-mobile-menu-text);">PLAY NHẠC</a>
      <a href="https://thiensutinhquang.io/playtholientuc/" target="_blank" rel="noopener noreferrer" class="nav-button-base footer-action-button w-full" style="color: var(--nav-mobile-menu-text);">KHO THƠ</a>
      <a href="https://thiensutinhquang.github.io/Playlist-YouTube/" target="_blank" rel="noopener noreferrer" class="nav-button-base footer-action-button w-full" style="color: var(--nav-mobile-menu-text);">PLAY VIDEO</a>
      <a href="#" id="platforms-mobile-link" class="nav-button-base footer-action-button w-full" style="color: var(--nav-mobile-menu-text);">NỀN TẢNG</a>
    </div>
  </header>

  <main class="container mx-auto px-4 py-8 max-w-3xl relative">
    <div class="flex flex-col sm:flex-row justify-between items-center mb-6 gap-4">
      <div class="flex gap-2">
        <button id="readBtn" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200 shadow-md" aria-label="Đọc bài viết">
          🔊 Đọc bài
        </button>
        <button id="likeBtn" class="nav-button-base like-button-style" aria-label="Thích bài viết này">
          ❤️ <span class="button-text-wrapper" id="likeCount">0</span>
        </button>
        <button id="shareBtn" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors duration-200 shadow-md" aria-label="Chia sẻ bài viết">
          📤 Chia sẻ
        </button>
      </div>
      <div class="flex gap-2 items-center">
        <input type="text" id="searchBox" placeholder="Tìm kiếm..." class="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 transition-all duration-200 w-full sm:w-auto" aria-label="Ô tìm kiếm">
        <button id="searchBtn" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors duration-200 shadow-md" aria-label="Tìm kiếm">
          🔍
        </button>
        <select id="themeSelector" class="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 transition-all duration-200" aria-label="Chọn chủ đề">
          <option value="default">Mặc định</option>
          <option value="green">Xanh Lục Tĩnh Lặng</option>
          <option value="purple">Tím Thiền Định</option>
          <option value="gold">Vàng Nhẹ Thoát Tục</option>
        </select>
        <button id="darkModeToggle" class="px-4 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-800 transition-colors duration-200 shadow-md" aria-label="Chuyển đổi chế độ sáng/tối">
          🌙
        </button>
      </div>
    </div>

    <!-- Main Content Area -->
    <div id="content" class="prose lg:prose-lg max-w-none bg-white p-6 rounded-lg shadow-xl">
      <h1 id="section-0" class="text-center text-4xl font-extrabold mb-6" style="color: var(--main-title-color); line-height: 1.3;">BÀI KỆ CÚNG DƯỜNG ĂN TRONG ÁNH SÁNG TÌNH THƯƠNG</h1>
      <p class="text-center text-2xl font-semibold mb-8" style="color: var(--content-heading-color);">
        Om Phật Tổ Tối Cao!<br>
        Om Đức Phật Tịnh Quang!<br>
        Om Vị Phật bên trong con!
      </p>

      <hr class="decorative-divider">

      <h2 id="section-1" class="text-2xl font-bold mb-4" style="color: var(--content-heading-color);">I. Lời Cúng Dường</h2>
      <p class="mb-4 leading-relaxed">
        Con thành tâm xin cúng dường Các Ngài<br>
        Tất cả đồ ăn này, con cầu xin Các Ngài<br>
        <span class="strong-emphasis">Gia Trì Lực Lượng Ánh Sáng Tình Thương</span><br>
        Vào tất cả đồ ăn này<br>
        Để cho con được ăn trong <span class="strong-emphasis">Ánh Sáng</span><br>
        Và <span class="strong-emphasis">Tình Yêu Thương</span> của Các Ngài
      </p>
      <p class="mb-6 leading-relaxed">
        Con xin thành tâm cảm tạ Các Ngài<br>
        Đã gia trì cho con<br>
        Được ăn những đồ ăn ngon bổ này.
      </p>

      <hr class="decorative-divider">

      <h2 id="section-2" class="text-2xl font-bold mb-4" style="color: var(--content-heading-color);">II. Hướng Dẫn Thực Hành</h2>
      <div class="important-note-box">
        <h3>Lưu ý quan trọng:</h3>
        <p class="mb-4 leading-relaxed">
          Khi các con ăn bất cứ đồ ăn gì thì các con hãy thành tâm chắp tay, tập trung vào đỉnh đầu và mắt Trí Huệ rồi các con cúng dường y như trên và các con phải cảm nhận được rõ rõ, ràng ràng là Các Ngài đang đổ <span class="strong-emphasis">Lực Lượng Gia Trì</span> xuống đỉnh đầu và mắt Trí Huệ của các con.
        </p>
        <p class="mb-0 leading-relaxed">
          Nếu các con cúng dường mà không cảm nhận được như vậy thì chứng tỏ là các con chưa được thành tâm lắm. Còn trước đông người không biết đến tu thì các con chỉ thầm cúng dường ở trong Tâm chứ không cần chắp tay.
        </p>
      </div>

      <hr class="decorative-divider">

      <!-- Summary Box for sections III and IV -->
      <div id="summaryBox">
        <h2 id="section-3" class="text-2xl font-bold mb-4" style="color: var(--content-heading-color);">III. Lợi Ích Của Sự Gia Trì</h2>
        <p class="mb-4 leading-relaxed">
          Bài kệ này đã được Ta lồng <span class="strong-emphasis">Lực Lượng Gia Trì</span> rất là mạnh, bất cứ ai trước khi ăn mà thành tâm cúng dường y như trên thì sẽ nhận được <span class="strong-emphasis">Sức Gia Trì không thể nghĩ bàn</span>, vì thế lúc đó đồ ăn của các con lung linh <span class="strong-emphasis">Ánh Sáng Hào Quang Rực Rỡ</span>... kể cả khi đang ăn mà các con cứ tập trung vào mắt Trí Huệ và đỉnh đầu thì các con vẫn nhận được <span class="strong-emphasis">Hào Quang Ánh Sáng gia trì liên tục</span> trong cả bữa ăn các con nhé, con nào có Thiên Nhãn sẽ thấy biết rõ ràng.
        </p>
        <p class="mb-4 leading-relaxed">
          Các con càng nhận được nhiều <span class="strong-emphasis">Ánh Sáng Tình Thương</span> từ Phật Trời gia trì vào đồ ăn đồ uống thì các con ăn đồ ăn ấy sẽ càng thơm ngon bổ dưỡng hơn, thân tâm của các con càng an lạc, bệnh tật được tiêu trừ, ngày càng sáng suốt, trẻ đẹp, khỏe ra và sự tu hành cũng được thăng hoa nhiều hơn.
        </p>

        <hr class="decorative-divider">

        <h2 id="section-4" class="text-2xl font-bold mb-4" style="color: var(--content-heading-color);">IV. Lời Khuyên Từ Minh Sư</h2>
        <p class="mb-4 leading-relaxed">
          Khi các con đọc kỹ bài Pháp này và áp dụng thực hành thì từ giờ các con cúng dường đồ ăn thì đồ ăn sẽ thơm ngon hơn, thậm chí trong lúc ăn mùi hương trầm thơm ngào ngạt suốt trong bữa ăn. Khi ăn, các con hãy ăn chậm rãi, nhai thật kỹ để thưởng thức cảm nhận vị ngon của đồ ăn chứ không phải ăn cho xong bữa.
        </p>
        <p class="mb-4 leading-relaxed">
          Ta nói thật bữa ăn nào của Ta đồ ăn cũng có rất rất nhiều <span class="strong-emphasis">Ánh Sáng Hào Quang</span> và những viên ngọc Lưu Ly ở trong đồ ăn, đồ uống. Vậy nên, Ta ăn trong <span class="strong-emphasis">Ánh Sáng</span>, Ta ngủ trong <span class="strong-emphasis">Ánh Sáng</span>, không giây phút nào là Ta không sống trong <span class="strong-emphasis">Ánh Sáng Hào Quang của Vũ Trụ</span>.
        </p>
        <p class="text-center text-xl font-semibold mt-6 mb-2 farewell-text">
          Ta chúc các con cũng được như vậy.
        </p>

        <div class="text-right mt-8 pt-4 border-t border-gray-300">
          <p class="font-bold text-lg text-gray-800">Minh Sư Tịnh Quang</p>
          <p class="text-sm text-gray-600">Úpice - Cộng Hòa Séc</p>
          <p class="text-sm text-gray-600">Ngày 29.5.2022</p>
        </div>
      </div> <!-- End of Summary Box -->

      <hr class="decorative-divider">

      <div class="teaching-quote-box">
        <h3>Lời Dạy Quan Trọng:</h3>
        <blockquote>
          "Ăn trong ánh sáng tình thương là sự kết nối linh thiêng giữa tâm và vật chất, giúp thanh tịnh thân tâm, tăng trưởng sức khỏe và thăng hoa tu hành."
        </blockquote>
      </div>

      <p class="mb-4 leading-relaxed">
        Các điểm chính cần ghi nhớ:
      </p>
      <ul>
        <li>Thực hành cúng dường mỗi bữa ăn.</li>
        <li>Tập trung vào đỉnh đầu và mắt Trí Huệ.</li>
        <li>Cảm nhận Lực Lượng Gia Trì.</li>
        <li>Ăn chậm rãi và thưởng thức.</li>
        <li>Sống trong Ánh Sáng Tình Thương.</li>
      </ul>

    </div>
  </main>

  <!-- Share Modal -->
  <div id="shareModal" class="fixed inset-0 bg-black/40 flex justify-center items-center z-[9999] hidden">
    <div class="bg-white p-6 rounded-lg shadow-xl w-80">
      <h2 class="text-lg font-bold mb-4 text-gray-800">Chia sẻ</h2>
      <div class="flex flex-col gap-3 mb-4">
        <a href="#" id="shareFacebook" target="_blank" rel="noopener noreferrer" class="flex items-center gap-2 text-blue-600 hover:underline p-2 rounded-lg hover:bg-blue-50 transition-colors duration-200" aria-label="Chia sẻ lên Facebook">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M14 12V8h3V5h-3V3c0-1.621.523-2 2-2h1V0h-3C10.2 0 9 1.2 9 5v3H6v4h3v10h4V12h3z"/></svg> Facebook
        </a>
        <button id="copyLinkBtn" class="flex items-center gap-2 text-green-600 hover:underline p-2 rounded-lg hover:bg-green-50 transition-colors duration-200 justify-start" aria-label="Sao chép liên kết">
          <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M13.121 7.21l.707-.707a1 1 0 011.414 0l2.828 2.828a1 1 0 010 1.414l-.707.707a1 1 0 01-1.414-1.414l.707-.707a.5.5 0 000-.707l-2.828-2.828a.5.5 0 00-.707 0l-.707.707a1 1 0 01-1.414-1.414zM8.464 16.789l-.707.707a1 1 0 01-1.414 0l-2.828-2.828a1 1 0 010-1.414l.707-.707a1 1 0 011.414 1.414l-.707.707a.5.5 0 000 .707l2.828 2.828a.5.5 0 00.707 0l.707-.707a1 1 0 011.414 1.414zM10 12a1 1 0 01-1-1V5a1 1 0 112 0v6a1 1 0 01-1 1z"/></svg> Sao chép liên kết
        </button>
      </div>
      <button id="closeShare" class="block mx-auto bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-colors duration-200 shadow-md" aria-label="Đóng cửa sổ chia sẻ">Đóng</button>
    </div>
  </div>

  <!-- Message Box for copy confirmation -->
  <div id="messageBox" class="fixed bottom-4 right-4 bg-gray-800 text-white px-4 py-2 rounded-lg shadow-lg hidden z-[10000]">
    Đã sao chép vào clipboard!
  </div>

  <!-- Floating Scroll Buttons -->
  <div class="fixed right-4 top-1/2 -translate-y-1/2 flex flex-col gap-2 z-40">
    <button id="scrollTopBtn" class="p-3 bg-yellow-500 text-white rounded-full shadow-lg hover:bg-yellow-600 transition-colors duration-200" aria-label="Cuộn lên đầu trang">
      <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 4l-8 8h6v8h4v-8h6z"/></svg>
    </button>
    <button id="scrollBottomBtn" class="p-3 bg-yellow-500 text-white rounded-full shadow-lg hover:bg-yellow-600 transition-colors duration-200" aria-label="Cuộn xuống cuối trang">
      <svg class="w-6 h-6" fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M12 20l8-8h-6V4h-4v8H4z"/></svg>
    </button>
  </div>

  <script type="module">
    // --- BẮT ĐẦU: MÃ LIÊN QUAN ĐẾN FIREBASE ---

    // 1. Nhập các mô-đun cần thiết từ Firebase SDK
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, doc, setDoc, onSnapshot, increment } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    // 2. Cấu hình Firebase của bạn
    // Thông tin này được lấy từ bảng điều khiển Firebase của dự án.
    const firebaseConfig = {
      apiKey: "AIzaSyCWv6m3Vw76HPYSRd96U847qViV_EJXZ0Q",
      authDomain: "giaolylikes.firebaseapp.com",
      projectId: "giaolylikes",
      storageBucket: "giaolylikes.firebasestorage.app",
      messagingSenderId: "580748260318",
      appId: "1:580748260318:web:0922e75d385ccab02fa34f"
    };

    // 3. Các biến toàn cục cho Firebase và dữ liệu
    let app, db, auth, userId;
    const ARTICLE_ID = 'mainArticleLikes'; // ID duy nhất cho bài viết này trong Firestore
    let currentLikeCount = 0; // Biến để lưu trữ số lượt thích hiện tại

    // 4. Hàm lắng nghe thay đổi dữ liệu lượt thích từ Firestore
    const setupLikesListener = () => {
      // Chỉ thực thi nếu Firestore đã được khởi tạo
      if (!db) {
        console.warn("Firestore chưa sẵn sàng để lắng nghe dữ liệu.");
        return;
      }
      
      // Tham chiếu đến tài liệu (document) chứa lượt thích của bài viết
      const articleRef = doc(db, `favorites`, ARTICLE_ID);
      console.log("Đường dẫn lắng nghe dữ liệu Firestore (read):", articleRef.path);

      // onSnapshot tạo một kết nối thời gian thực để lắng nghe các thay đổi
      onSnapshot(articleRef, (docSnap) => {
        const likeCountSpan = document.getElementById('likeCount');
        
        // Nếu tài liệu tồn tại, cập nhật số lượt thích
        if (docSnap.exists()) {
          currentLikeCount = docSnap.data().likes || 0;
        } else {
          // Nếu tài liệu chưa tồn tại, tạo mới với 0 lượt thích
          currentLikeCount = 0;
          setDoc(articleRef, { likes: 0 }, { merge: true })
            .catch(e => console.error("Lỗi khi khởi tạo tài liệu lượt thích:", e));
        }
        
        // Hiển thị số lượt thích lên giao diện người dùng
        if (likeCountSpan) {
            likeCountSpan.textContent = currentLikeCount;
        }
        console.log("Số lượt thích hiện tại:", currentLikeCount);
      }, (error) => {
        // Xử lý lỗi nếu không thể lắng nghe dữ liệu
        console.error("Lỗi khi lắng nghe dữ liệu lượt thích:", error);
        // showMessageBox("Lỗi khi tải số lượt thích. Vui lòng kiểm tra kết nối mạng.");
      });
    };

    // 5. Hàm khởi tạo Firebase và xử lý đăng nhập
    const initFirebase = async () => {
      try {
        // Khởi tạo ứng dụng Firebase
        app = initializeApp(firebaseConfig);
        db = getFirestore(app);
        auth = getAuth(app);

        // Đăng nhập ẩn danh để mỗi người dùng có một UID duy nhất
        await signInAnonymously(auth);
        console.log("Đã đăng nhập ẩn danh thành công.");

        // Lắng nghe sự thay đổi trạng thái đăng nhập
        onAuthStateChanged(auth, (user) => {
          if (user) {
            // Nếu có người dùng, lấy UID và bắt đầu lắng nghe dữ liệu lượt thích
            userId = user.uid;
            console.log("User ID:", userId);
            setupLikesListener();
          } else {
            // Nếu không có người dùng
            console.log("Không có người dùng nào được đăng nhập.");
            userId = null;
          }
        });
      } catch (error) {
        // Xử lý lỗi nếu không thể khởi tạo Firebase
        console.error("Lỗi khi khởi tạo Firebase hoặc đăng nhập:", error);
        // showMessageBox("Lỗi khởi tạo Firebase. Vui lòng kiểm tra cấu hình API Key và các thông số khác.");
      }
    };

    // 6. Xử lý sự kiện khi người dùng nhấn nút "Thích"
    const likeBtn = document.getElementById('likeBtn');
    if (likeBtn) {
      likeBtn.onclick = async (e) => { // Added 'e' parameter for event object
        // Kiểm tra xem Firestore đã sẵn sàng chưa
        if (!db) {
          console.error("Firestore chưa được khởi tạo. Không thể cập nhật lượt thích.");
          // showMessageBox("Lỗi: Không thể kết nối đến máy chủ. Vui lòng kiểm tra cấu hình Firebase.");
          return;
        }
        
        // Tham chiếu đến tài liệu cần cập nhật
        const articleRef = doc(db, `favorites`, ARTICLE_ID);
        console.log("Đường dẫn cập nhật dữ liệu Firestore (write):", articleRef.path);

        try {
          // Sử dụng `increment(1)` để tăng giá trị 'likes' lên 1 một cách an toàn
          await setDoc(articleRef, { likes: increment(1) }, { merge: true });
          console.log("Đã cập nhật số lượt thích trên Firestore.");

          // Tạo hiệu ứng trái tim rơi
          const heart = document.createElement('div');
          heart.textContent = '❤️';
          heart.className = 'rain-heart';
          const rect = likeBtn.getBoundingClientRect();
          heart.style.left = (e.clientX - rect.left + likeBtn.offsetWidth / 2 - 10) + 'px';
          heart.style.top = (e.clientY - rect.top + likeBtn.offsetHeight / 2 - 10) + 'px';
          likeBtn.appendChild(heart);
          setTimeout(() => heart.remove(), 1000);

        } catch (error) {
          // Xử lý lỗi nếu không thể cập nhật
          console.error("Lỗi khi cập nhật số lượt thích:", error);
          // showMessageBox("Lỗi khi thích bài viết. Vui lòng kiểm tra quy tắc bảo mật Firestore và kết nối.");
        }
      };
    }

    // 7. Gọi hàm khởi tạo để bắt đầu toàn bộ quá trình
    initFirebase();

    // --- KẾT THÚC: MÃ LIÊN QUAN ĐẾN FIREBASE ---

    // --- CÁC HÀM VÀ BIẾN KHÁC CỦA TRANG WEB ---

    // Message Box Display (đã có ở trên, giữ lại nếu muốn dùng riêng)
    function showMessageBox(message) {
      const messageBox = document.getElementById('messageBox');
      if (messageBox) {
        messageBox.textContent = message;
        messageBox.classList.remove('hidden');
        setTimeout(() => {
          messageBox.classList.add('hidden');
        }, 3000);
      } else {
        console.warn("Message box element not found.");
      }
    }

    // Clear highlights for search functionality (đã có ở trên)
    let lastHighlightedRanges = [];

    function clearHighlights() {
      const content = document.getElementById('content');
      if (content) {
        const highlights = content.querySelectorAll('.highlight');
        highlights.forEach(span => {
          const parent = span.parentNode;
          while (span.firstChild) {
            parent.insertBefore(span.firstChild, span);
          }
          parent.removeChild(span);
        });
        content.normalize();
        lastHighlightedRanges = [];
      }
    }

    // Apply Theme Logic (đã có ở trên)
    const themes = ['default', 'green', 'purple', 'gold'];

    const applyTheme = (themeName) => {
      themes.forEach(theme => {
        document.body.classList.remove(`theme-${theme}`);
      });
      if (themeName !== 'default') {
        document.body.classList.add(`theme-${themeName}`);
      }
      localStorage.setItem('selectedTheme', themeName);
    };

    // Text-to-Speech Helper Functions (đã có ở trên)
    let speechSynthesizer = null;
    let paragraphElements = [];
    let currentParagraphIndex = 0;
    let currentUtterance = null;
    let isSpeechReady = false;

    function initializeParagraphElements() {
      const content = document.getElementById('content');
      if (content) {
        paragraphElements = Array.from(content.querySelectorAll('h1, h2, p, blockquote, ul li')); // Bao gồm cả blockquote và ul li
      }
    }

    const initSpeechSynthesis = () => {
      speechSynthesizer = window.speechSynthesis;
      const readBtn = document.getElementById('readBtn');
      if (!speechSynthesizer) {
        console.warn("SpeechSynthesis not supported in this browser.");
        showMessageBox("Trình duyệt của bạn không hỗ trợ đọc văn bản.");
        if (readBtn) readBtn.disabled = true;
        return;
      }

      const checkVoices = () => {
        const voices = speechSynthesis.getVoices();
        console.log("Checking voices. Found:", voices.length, "voices.");
        if (voices.length > 0) {
          isSpeechReady = true;
          console.log("SpeechSynthesis is ready.");
          if (readBtn) readBtn.disabled = false;
          showMessageBox("Hệ thống đọc bài đã sẵn sàng.");
          return true;
        }
        return false;
      };

      if (checkVoices()) {
        return;
      }

      speechSynthesizer.onvoiceschanged = () => {
        console.log("SpeechSynthesis voices changed event fired.");
        checkVoices();
      };

      let voiceCheckInterval = setInterval(() => {
        if (checkVoices()) {
          clearInterval(voiceCheckInterval);
        } else {
          console.log("Polling for voices... Still not ready.");
        }
      }, 500);

      setTimeout(() => {
        if (!isSpeechReady) {
          clearInterval(voiceCheckInterval);
          console.warn("SpeechSynthesis voices not loaded after timeout.");
          showMessageBox("Không thể tải giọng đọc. Vui lòng thử lại hoặc kiểm tra cài đặt giọng nói của trình duyệt/hệ điều hành.");
          if (readBtn) readBtn.disabled = true;
        }
      }, 15000);
    };

    function clearAllHighlightsForSpeech() {
      paragraphElements.forEach(el => el.classList.remove('highlight-paragraph'));
    }

    function stopReading() {
      const readBtn = document.getElementById('readBtn');
      if (speechSynthesizer && readBtn) {
        speechSynthesizer.cancel();
      }
      clearAllHighlightsForSpeech();
      currentParagraphIndex = 0;
      if (readBtn) readBtn.textContent = '🔊 Đọc bài';
      console.log("Reading stopped. Resetting button and highlights.");
    }

    function startReading() {
      const readBtn = document.getElementById('readBtn');
      clearAllHighlightsForSpeech();

      if (!isSpeechReady || !speechSynthesizer) {
        showMessageBox("Hệ thống đọc bài chưa sẵn sàng. Vui lòng thử lại sau.");
        console.error("Attempted to start reading when SpeechSynthesis was not ready.");
        if (readBtn) readBtn.disabled = true;
        return;
      }

      if (currentParagraphIndex >= paragraphElements.length) {
        console.log("End of article reached. Stopping reading.");
        stopReading();
        return;
      }

      const currentElement = paragraphElements[currentParagraphIndex];
      currentElement.classList.add('highlight-paragraph');
      currentElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
      console.log(`Reading paragraph ${currentParagraphIndex}:`, currentElement.innerText.substring(0, 50) + "...");

      currentUtterance = new SpeechSynthesisUtterance(currentElement.innerText);

      const voices = speechSynthesizer.getVoices();
      const vietnameseVoice = voices.find(voice => voice.lang === 'vi-VN');
      if (vietnameseVoice) {
        currentUtterance.voice = vietnameseVoice;
        console.log("Using Vietnamese voice.");
      } else {
        console.warn("Vietnamese voice not found. Using default voice or first available voice.");
        if (voices.length > 0) {
            currentUtterance.voice = voices[0];
            console.log("Using first available voice:", voices[0].name);
        } else {
            console.error("No voices available at all, cannot speak.");
            showMessageBox("Không có giọng đọc nào khả dụng. Vui lòng kiểm tra cài đặt giọng nói của trình duyệt/hệ điều hành.");
            stopReading();
            return;
        }
      }

      currentUtterance.onend = () => {
        console.log(`Finished paragraph ${currentParagraphIndex}.`);
        currentElement.classList.remove('highlight-paragraph');
        currentParagraphIndex++;
        startReading();
      };

      currentUtterance.onerror = (event) => {
        console.error('SpeechSynthesisUtterance.onerror triggered:', event);
        console.error('Error details:', event.error);
        stopReading();
        showMessageBox("Lỗi khi đọc bài viết. Vui lòng thử lại hoặc kiểm tra cài đặt giọng nói của trình duyệt.");
      };

      speechSynthesizer.speak(currentUtterance);
      if (readBtn) readBtn.textContent = '⏸️ Tạm dừng';
    }

    const updateTocActive = () => {
      const tocLinks = [];
      const headers = document.getElementById('content').querySelectorAll('h1, h2');
      headers.forEach((header, i) => {
        const id = 'section-' + i;
        const link = document.querySelector(`#toc a[href="#${id}"]`);
        if (link) {
          tocLinks.push({ id, link, element: header });
        }
      });

      let currentActive = null;
      for (let i = tocLinks.length - 1; i >= 0; i--) {
        const { element, link } = tocLinks[i];
        const rect = element.getBoundingClientRect();
        if (rect.top <= window.innerHeight / 2) {
          currentActive = link;
          break;
        }
      }
      tocLinks.forEach(({ link }) => link.classList.remove('toc-active'));
      if (currentActive) {
        currentActive.classList.add('toc-active');
      }
    };


    // --- DOM Elements ---
    const menuToggle = document.getElementById('menuToggle');
    const mobileMenu = document.getElementById('mobile-menu');
    const closeMenu = document.getElementById('closeMenu');
    const toc = document.getElementById('toc');
    const content = document.getElementById('content');
    const scrollProgress = document.getElementById('scrollProgress');
    const readBtn = document.getElementById('readBtn');
    const likeCountSpan = document.getElementById('likeCount'); // Defined here for global access
    const shareBtn = document.getElementById('shareBtn');
    const shareModal = document.getElementById('shareModal');
    const closeShare = document.getElementById('closeShare');
    const shareFacebook = document.getElementById('shareFacebook');
    const copyLinkBtn = document.getElementById('copyLinkBtn');
    const messageBox = document.getElementById('messageBox');
    const searchBox = document.getElementById('searchBox');
    const searchBtn = document.getElementById('searchBtn');
    const darkModeToggle = document.getElementById('darkModeToggle');
    const themeSelector = document.getElementById('themeSelector');
    const scrollTopBtn = document.getElementById('scrollTopBtn');
    const scrollBottomBtn = document.getElementById('scrollBottomBtn');

    // New navigation specific elements
    const dropdown = document.getElementById('platforms-dropdown');
    const dropdownBtn = document.getElementById('platforms-btn');
    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const platformsMobileLink = document.getElementById('platforms-mobile-link');


    // --- Event Listeners ---

    // Mobile menu toggle
    if (mobileMenuButton) mobileMenuButton.onclick = () => mobileMenu.classList.toggle('hidden');
    if (closeMenu) closeMenu.onclick = () => mobileMenu.classList.add('hidden');


    // Desktop dropdown
    if (dropdownBtn) {
      dropdownBtn.addEventListener('click', (event) => {
        event.stopPropagation();
        if (dropdown) dropdown.classList.toggle('show');
      });
    }

    // Close desktop dropdown when clicking outside
    document.addEventListener('click', (event) => {
      if (dropdown && !dropdown.contains(event.target)) {
        dropdown.classList.remove('show');
      }
    });

    // Mobile platforms link (using showMessageBox)
    if (platformsMobileLink) {
      platformsMobileLink.addEventListener('click', (e) => {
        e.preventDefault();
        showMessageBox('Vui lòng truy cập các nền tảng:\n- YouTube\n- TikTok\n- Facebook\n- Telegram\n- Zalo');
      });
    }

    window.addEventListener('DOMContentLoaded', () => {
      initializeParagraphElements();
      initSpeechSynthesis();
      const headers = content.querySelectorAll('h1, h2');
      const tocLinksArray = [];
      headers.forEach((header, i) => {
        const id = 'section-' + i;
        header.id = id;
        const link = document.createElement('a');
        link.href = '#' + id;
        link.textContent = header.textContent;
        link.className = 'block py-1 px-2 rounded-md hover:bg-yellow-100 transition-colors duration-200';
        if (toc) toc.appendChild(link);
        tocLinksArray.push({ id, link, element: header });

        link.addEventListener('click', (e) => {
          e.preventDefault();
          header.scrollIntoView({ behavior: 'smooth' });
          setTimeout(() => updateTocActive(), 600);
        });
      });
    });

    window.onscroll = () => {
      if (scrollProgress) {
        const scrolled = (window.scrollY / (document.body.scrollHeight - window.innerHeight)) * 100;
        scrollProgress.style.width = scrolled + '%';
      }
      updateTocActive();
    };

    if (readBtn) {
      readBtn.onclick = () => {
        if (!isSpeechReady) {
          showMessageBox("Đang tải giọng đọc, vui lòng thử lại sau giây lát.");
          return;
        }
        if (speechSynthesizer.speaking && !speechSynthesizer.paused) {
          console.log("Pausing speech.");
          speechSynthesizer.pause();
          readBtn.textContent = '▶️ Tiếp tục';
          return;
        }
        if (speechSynthesizer.paused) {
          console.log("Resuming speech.");
          speechSynthesizer.resume();
          readBtn.textContent = '⏸️ Tạm dừng';
          return;
        }
        console.log("Starting speech.");
        startReading();
      };
    }

    // likeBtn logic is now handled by the Firebase section above,
    // but the event listener assignment needs to remain here.
    // The actual logic is in the Firebase section.

    if (shareBtn) {
      shareBtn.onclick = () => {
        if (shareModal) shareModal.classList.remove('hidden');
        const currentUrl = window.location.href;
        if (shareFacebook) shareFacebook.href = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(currentUrl)}`;
      };
    }
    if (closeShare) closeShare.onclick = () => shareModal.classList.add('hidden');
    if (shareModal) {
      shareModal.addEventListener('click', (e) => {
        if (e.target === shareModal) {
          shareModal.classList.add('hidden');
        }
      });
    }

    if (copyLinkBtn) {
      copyLinkBtn.onclick = () => {
        const currentUrl = window.location.href;
        try {
          const tempInput = document.createElement('textarea');
          tempInput.value = currentUrl;
          document.body.appendChild(tempInput);
          tempInput.select();
          document.execCommand('copy');
          document.body.removeChild(tempInput);
          showMessageBox('Đã sao chép vào clipboard!');
          if (shareModal) shareModal.classList.add('hidden');
        } catch (err) {
          console.error('Failed to copy text: ', err);
          showMessageBox('Sao chép thất bại. Vui lòng sao chép thủ công.');
        }
      };
    }

    if (searchBtn) {
      searchBtn.onclick = () => {
        const searchTerm = searchBox.value.trim();
        if (searchTerm === '') {
          clearHighlights();
          return;
        }
        clearHighlights();
        const walker = document.createTreeWalker(content, NodeFilter.SHOW_TEXT, null, false);
        let node;
        let foundCount = 0;
        const rangesToHighlight = [];
        while ((node = walker.nextNode())) {
          const text = node.nodeValue;
          let startIndex = 0;
          while ((startIndex = text.toLowerCase().indexOf(searchTerm.toLowerCase(), startIndex)) !== -1) {
            const range = document.createRange();
            range.setStart(node, startIndex);
            range.setEnd(node, startIndex + searchTerm.length);
            rangesToHighlight.push(range);
            startIndex += searchTerm.length;
            foundCount++;
          }
        }
        if (foundCount > 0) {
          rangesToHighlight.forEach(range => {
            const span = document.createElement('span');
            span.classList.add('highlight');
            range.surroundContents(span);
          });
          lastHighlightedRanges = rangesToHighlight;
          showMessageBox(`Tìm thấy ${foundCount} kết quả.`);
        } else {
          showMessageBox('Không tìm thấy kết quả nào.');
        }
      };
    }

    if (searchBox) {
      searchBox.addEventListener('input', () => {
        if (searchBox.value.trim() === '') {
          clearHighlights();
        }
      });
    }

    if (darkModeToggle) {
      darkModeToggle.onclick = () => {
        document.body.classList.toggle('dark');
        if (document.body.classList.contains('dark')) {
          localStorage.setItem('theme', 'dark');
          darkModeToggle.innerHTML = '☀️';
        } else {
          localStorage.setItem('theme', 'light');
          darkModeToggle.innerHTML = '🌙';
        }
      };
    }

    window.addEventListener('DOMContentLoaded', () => {
      const savedTheme = localStorage.getItem('selectedTheme');
      if (savedTheme) {
        applyTheme(savedTheme);
        if (themeSelector) themeSelector.value = savedTheme;
      } else {
        applyTheme('default');
        if (themeSelector) themeSelector.value = 'default';
      }

      const savedDarkMode = localStorage.getItem('theme');
      if (savedDarkMode === 'dark') {
        document.body.classList.add('dark');
        if (darkModeToggle) darkModeToggle.innerHTML = '☀️'; 
      } else {
        if (darkModeToggle) darkModeToggle.innerHTML = '🌙';
      }
    });

    if (themeSelector) {
      themeSelector.onchange = (event) => {
        applyTheme(event.target.value);
      };
    }

    window.addEventListener('beforeunload', () => {
      if (speechSynthesizer && speechSynthesizer.speaking) {
        speechSynthesizer.cancel();
      }
    });

    // --- Floating Scroll Buttons Logic ---
    if (scrollTopBtn) {
      scrollTopBtn.onclick = () => {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      };
    }

    if (scrollBottomBtn) {
      scrollBottomBtn.onclick = () => {
        window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
      };
    }

  </script>
</body>

</html>
