<!DOCTYPE html>
<html lang="vi">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Trang Tu T·∫≠p N√¢ng C·∫•p</title>
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Font Awesome for icons -->
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  <!-- Google Fonts - Inter for a modern look -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <style>
    /* Custom selection style */
    ::selection {
      background: gold;
      color: black;
    }

    /* Active state for Table of Contents links */
    .toc-active {
      font-weight: bold;
      color: #f59e0b; /* Tailwind yellow-500 */
    }

    /* Rain heart animation for like button */
    .rain-heart {
      position: absolute;
      animation: fall 1s ease-out forwards;
      pointer-events: none; /* Allow clicks to pass through */
      z-index: 10000; /* Ensure hearts are on top */
    }

    @keyframes fall {
      0% {
        opacity: 1;
        transform: translateY(-10px) scale(1);
      }
      100% {
        opacity: 0;
        transform: translateY(100px) scale(0.5);
      }
    }

    /* Highlight for search functionality */
    .highlight {
      background-color: yellow;
      padding: 2px 0;
    }

    /* Highlight for current reading paragraph */
    .highlight-paragraph {
      background-color: #fffacd; /* Light yellow for highlighting */
      transition: background-color 0.3s ease;
      padding: 0.25em 0.5em; /* Add some padding for better visual */
      border-radius: 0.25em; /* Rounded corners for highlight */
      display: block; /* Ensure it takes full width */
    }

    /* Dark mode adjustment for highlight */
    body.dark .highlight-paragraph {
      background-color: #3a3f4a; /* Darker shade for contrast in dark mode */
    }

    /* Smooth scroll behavior */
    html {
      scroll-behavior: smooth;
    }

    /* Apply Inter font globally */
    body {
      font-family: 'Inter', sans-serif;
    }

    /* Dark mode styles (applied on top of themes) */
    body.dark {
      background-color: #1a202c; /* Tailwind gray-900 */
      color: #e2e8f0; /* Tailwind gray-200 */
    }

    body.dark .bg-white {
      background-color: #2d3748; /* Tailwind gray-800 */
    }

    body.dark .text-gray-900 {
      color: #e2e8f0;
    }

    body.dark .bg-yellow-200 {
      background-color: #4a5568; /* Tailwind gray-700 */
    }

    body.dark .text-yellow-900 {
      color: #f6e05e; /* Tailwind yellow-300 */
    }

    body.dark .bg-gray-200 {
      background-color: #4a5568;
      color: #e2e8f0;
    }

    body.dark .bg-gray-300 {
      background-color: #6a7382;
    }

    body.dark #shareModal > div {
      background-color: #2d3748;
    }

    /* --- New Theme Styles --- */

    /* Xanh L·ª•c Tƒ©nh L·∫∑ng (Serene Green) */
    body.theme-green {
      background-color: #e0f2f7; /* Light Cyan */
      color: #2f4f4f; /* Dark Slate Gray */
    }
    body.theme-green .bg-yellow-200 {
      background-color: #a7d9d9; /* Lighter Teal */
    }
    body.theme-green .text-yellow-900 {
      color: #2f4f4f;
    }
    body.theme-green .bg-gray-50 {
      background-color: #c0e0e0; /* Light Teal */
    }
    body.theme-green .bg-gray-200 {
      background-color: #80ced6; /* Medium Teal */
    }
    body.theme-green .text-gray-800 {
      color: #2f4f4f;
    }
    body.theme-green .bg-gray-700 {
      background-color: #5f9ea0; /* Cadet Blue */
    }
    body.theme-green .bg-pink-500 {
      background-color: #ffb6c1; /* Light Pink for contrast */
    }
    body.theme-green .bg-blue-600 {
      background-color: #6495ed; /* Cornflower Blue for contrast */
    }
    body.theme-green #shareModal > div {
      background-color: #e0f2f7;
    }
    body.theme-green #content {
      background-color: #d4f0f0; /* Slightly darker light cyan for content */
    }

    /* T√≠m Thi·ªÅn ƒê·ªãnh (Meditative Purple) */
    body.theme-purple {
      background-color: #f0e6fa; /* Lavender Blush */
      color: #4b0082; /* Indigo */
    }
    body.theme-purple .bg-yellow-200 {
      background-color: #d8bfd8; /* Thistle */
    }
    body.theme-purple .text-yellow-900 {
      color: #4b0082;
    }
    body.theme-purple .bg-gray-50 {
      background-color: #e6cce6; /* Plum */
    }
    body.theme-purple .bg-gray-200 {
      background-color: #b0e0e6; /* Powder Blue (for contrast) */
    }
    body.theme-purple .text-gray-800 {
      color: #4b0082;
    }
    body.theme-purple .bg-gray-700 {
      background-color: #9370db; /* Medium Purple */
    }
    body.theme-purple .bg-pink-500 {
      background-color: #ff69b4; /* Hot Pink for contrast */
    }
    body.theme-purple .bg-blue-600 {
      background-color: #8a2be2; /* Blue Violet for contrast */
    }
    body.theme-purple #shareModal > div {
      background-color: #f0e6fa;
    }
    body.theme-purple #content {
      background-color: #e8d0f2; /* Slightly darker lavender for content */
    }

    /* V√†ng Nh·∫π Tho√°t T·ª•c (Subtle Yellow/Gold) */
    body.theme-gold {
      background-color: #fffaf0; /* Floral White */
      color: #5a4a3a; /* Darker Brown */
    }
    body.theme-gold .bg-yellow-200 {
      background-color: #ffe4b5; /* Moccasin */
    }
    body.theme-gold .text-yellow-900 {
      color: #5a4a3a;
    }
    body.theme-gold .bg-gray-50 {
      background-color: #fffacd; /* Lemon Chiffon */
    }
    body.theme-gold .bg-gray-200 {
      background-color: #f0e68c; /* Khaki */
    }
    body.theme-gold .text-gray-800 {
      color: #5a4a3a;
    }
    body.theme-gold .bg-gray-700 {
      background-color: #daa520; /* Goldenrod */
    }
    body.theme-gold .bg-pink-500 {
      background-color: #ffc0cb; /* Pink for contrast */
    }
    body.theme-gold .bg-blue-600 {
      background-color: #add8e6; /* Light Blue for contrast */
    }
    body.theme-gold #shareModal > div {
      background-color: #fffaf0;
    }
    body.theme-gold #content {
      background-color: #fff5e0; /* Slightly darker floral white for content */
    }
  </style>
</head>

<body class="bg-white text-gray-900 transition-all duration-300">
  <!-- Scroll Progress Bar -->
  <div id="scrollProgress" class="fixed top-0 left-0 h-1 bg-yellow-400 z-[9999]" style="width: 0%;"></div>

  <!-- Navigation Header -->
  <header class="bg-yellow-200 shadow sticky top-0 z-50 rounded-b-lg">
    <div class="container mx-auto px-4 py-3 flex justify-between items-center">
      <!-- Logo and Site Title -->
      <a href="#" class="flex items-center space-x-2 text-xl font-bold text-yellow-900" onclick="window.scrollTo({ top: 0, behavior: 'smooth' }); return false;">
        <img src="https://raw.githubusercontent.com/thiensutinhquang/Admin/main/icons/icon.png" alt="Logo Gi√°o L√Ω MSTQ" class="h-8 w-auto rounded-full">
        <span>Gi√°o L√Ω MSTQ</span>
      </a>
      <nav class="hidden md:flex space-x-4 text-sm">
        <a href="#" class="hover:underline p-2 rounded-lg hover:bg-yellow-300 transition-colors duration-200">Trang ch·ªß</a>
        <a href="#" class="hover:underline p-2 rounded-lg hover:bg-yellow-300 transition-colors duration-200">Play Nh·∫°c</a>
        <a href="#" class="hover:underline p-2 rounded-lg hover:bg-yellow-300 transition-colors duration-200">Kho Th∆°</a>
        <a href="#" class="hover:underline p-2 rounded-lg hover:bg-yellow-300 transition-colors duration-200">Play Video</a>
        <a href="https://facebook.com" target="_blank" class="hover:underline p-2 rounded-lg hover:bg-yellow-300 transition-colors duration-200">Facebook</a>
        <a href="https://youtube.com" target="_blank" class="hover:underline p-2 rounded-lg hover:bg-yellow-300 transition-colors duration-200">YouTube</a>
      </nav>
      <button id="menuToggle" class="md:hidden text-yellow-900 p-2 rounded-lg hover:bg-yellow-300 transition-colors duration-200">
        <i class="fas fa-bars text-2xl"></i>
      </button>
    </div>
  </header>

  <!-- Mobile Menu -->
  <div id="mobileMenu" class="fixed inset-0 bg-white z-[999] p-6 hidden flex-col space-y-4 rounded-lg shadow-lg">
    <button id="closeMenu" class="self-end text-yellow-900 p-2 rounded-lg hover:bg-yellow-100 transition-colors duration-200"><i class="fas fa-times text-2xl"></i></button>
    <a href="#" class="hover:underline p-2 rounded-lg hover:bg-yellow-100 transition-colors duration-200">Trang ch·ªß</a>
    <a href="#" class="hover:underline p-2 rounded-lg hover:bg-yellow-100 transition-colors duration-200">Play Nh·∫°c</a>
    <a href="#" class="hover:underline p-2 rounded-lg hover:bg-yellow-100 transition-colors duration-200">Kho Th∆°</a>
    <a href="#" class="hover:underline p-2 rounded-lg hover:bg-yellow-100 transition-colors duration-200">Play Video</a>
    <a href="https://facebook.com" target="_blank" class="hover:underline p-2 rounded-lg hover:bg-yellow-100 transition-colors duration-200">Facebook</a>
    <a href="https://youtube.com" target="_blank" class="hover:underline p-2 rounded-lg hover:bg-yellow-100 transition-colors duration-200">YouTube</a>
  </div>

  <!-- Table of Contents (TOC) -->
  <aside class="hidden lg:block fixed left-4 top-24 w-56 text-sm bg-gray-50 p-4 rounded-lg shadow-md" id="toc">
    <h3 class="font-bold text-lg mb-2 text-yellow-800">M·ª•c L·ª•c</h3>
    <!-- TOC links will be dynamically inserted here -->
  </aside>

  <main class="container mx-auto px-4 py-8 max-w-3xl relative">
    <div class="flex flex-col sm:flex-row justify-between items-center mb-6 gap-4">
      <div class="flex gap-2">
        <button id="readBtn" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors duration-200 shadow-md">
          üîä ƒê·ªçc b√†i
        </button>
        <button id="likeBtn" class="relative px-4 py-2 bg-pink-500 text-white rounded-lg hover:bg-pink-600 transition-colors duration-200 shadow-md">
          ‚ù§Ô∏è <span id="likeCount">0</span>
        </button>
        <button id="shareBtn" class="px-4 py-2 bg-gray-200 text-gray-800 rounded-lg hover:bg-gray-300 transition-colors duration-200 shadow-md">
          üì§ Chia s·∫ª
        </button>
      </div>
      <div class="flex gap-2 items-center">
        <input type="text" id="searchBox" placeholder="T√¨m ki·∫øm..." class="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 transition-all duration-200 w-full sm:w-auto">
        <button id="searchBtn" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors duration-200 shadow-md">
          üîç
        </button>
        <select id="themeSelector" class="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500 transition-all duration-200">
          <option value="default">M·∫∑c ƒë·ªãnh</option>
          <option value="green">Xanh L·ª•c Tƒ©nh L·∫∑ng</option>
          <option value="purple">T√≠m Thi·ªÅn ƒê·ªãnh</option>
          <option value="gold">V√†ng Nh·∫π Tho√°t T·ª•c</option>
        </select>
        <button id="darkModeToggle" class="px-4 py-2 bg-gray-700 text-white rounded-lg hover:bg-gray-800 transition-colors duration-200 shadow-md">
          üåô
        </button>
      </div>
    </div>

    <!-- Main Content Area -->
    <div id="content" class="prose lg:prose-lg max-w-none bg-white p-6 rounded-lg shadow-xl">
      <h1 id="section-0">√Ånh s√°ng v√† s·ª± s·ªëng trong tu t·∫≠p</h1>
      <p><strong>M·ªü ƒë·∫ßu:</strong> Trong mu√¥n lo√†i v·∫°n v·∫≠t, √°nh s√°ng ch√≠nh l√† ngu·ªìn g·ªëc c·ªßa s·ª± s·ªëng, l√† y·∫øu t·ªë thi·∫øt y·∫øu nu√¥i d∆∞·ª°ng m·ªçi sinh linh. T·ª´ √°nh n·∫Øng m·∫∑t tr·ªùi r·ª±c r·ª° ban ng√†y ƒë·∫øn √°nh trƒÉng d·ªãu m√°t ƒë√™m v·ªÅ, hay √°nh sao l·∫•p l√°nh tr√™n b·∫ßu tr·ªùi, t·∫•t c·∫£ ƒë·ªÅu mang theo m·ªôt th√¥ng ƒëi·ªáp v·ªÅ s·ª± t·ªìn t·∫°i, v·ªÅ nƒÉng l∆∞·ª£ng v√† s·ª± ph√°t tri·ªÉn. Trong con ƒë∆∞·ªùng tu t·∫≠p t√¢m linh, √°nh s√°ng kh√¥ng ch·ªâ l√† m·ªôt hi·ªán t∆∞·ª£ng v·∫≠t l√Ω m√† c√≤n l√† bi·ªÉu t∆∞·ª£ng s√¢u s·∫Øc cho tr√≠ tu·ªá, s·ª± gi√°c ng·ªô v√† nƒÉng l∆∞·ª£ng thi√™ng li√™ng. N√≥ l√† kim ch·ªâ nam d·∫´n l·ªëi, l√† ngu·ªìn s·ª©c m·∫°nh n·ªôi t·∫°i gi√∫p ng∆∞·ªùi h√†nh gi·∫£ v∆∞·ª£t qua m·ªçi ch∆∞·ªõng ng·∫°i, h∆∞·ªõng t·ªõi s·ª± ho√†n thi·ªán.</p>

      <h2 id="section-1">√Ånh s√°ng n·ªôi t√¢m: N·ªÅn t·∫£ng c·ªßa s·ª± gi√°c ng·ªô</h2>
      <p>Khi ng∆∞·ªùi h√†nh gi·∫£ b∆∞·ªõc v√†o con ƒë∆∞·ªùng tu h·ªçc, ƒëi·ªÅu ƒë·∫ßu ti√™n c·∫ßn nh·∫≠n th·ª©c l√† t·∫ßm quan tr·ªçng c·ªßa √°nh s√°ng n·ªôi t√¢m. √Ånh s√°ng n√†y kh√¥ng ph·∫£i l√† th·ª© c√≥ th·ªÉ nh√¨n th·∫•y b·∫±ng m·∫Øt th∆∞·ªùng, m√† l√† s·ª± minh tri·∫øt, s·ª± hi·ªÉu bi·∫øt s√¢u s·∫Øc v·ªÅ b·∫£n ch·∫•t c·ªßa v·∫°n v·∫≠t v√† v·ªÅ ch√≠nh m√¨nh. N√≥ l√† s·ª± th·ª©c t·ªânh c·ªßa l∆∞∆°ng tri, l√† kh·∫£ nƒÉng ph√¢n bi·ªát thi·ªán √°c, ƒë√∫ng sai, l√† s·ª± nh·∫≠n di·ªán ch√¢n l√Ω trong t·ª´ng h∆°i th·ªü, t·ª´ng √Ω ni·ªám. Vi·ªác nu√¥i d∆∞·ª°ng √°nh s√°ng n·ªôi t√¢m ƒë√≤i h·ªèi s·ª± ki√™n tr√¨, tinh t·∫•n trong thi·ªÅn ƒë·ªãnh, qu√°n chi·∫øu v√† th·ª±c h√†nh gi·ªõi lu·∫≠t. M·ªói khi m·ªôt phi·ªÅn n√£o ƒë∆∞·ª£c h√≥a gi·∫£i, m·ªôt ch·∫•p tr∆∞·ªõc ƒë∆∞·ª£c bu√¥ng b·ªè, √°nh s√°ng trong t√¢m l·∫°i c√†ng r·ª±c r·ª° h∆°n, soi r·ªçi r√µ r√†ng h∆°n con ƒë∆∞·ªùng ph√≠a tr∆∞·ªõc.</p>

      <h2 id="section-2">V∆∞·ª£t qua b√≥ng t·ªëi: Nh·ªØng ch∆∞·ªõng ng·∫°i tr√™n con ƒë∆∞·ªùng tu</h2>
      <p>Thi·∫øu √°nh s√°ng, con ƒë∆∞·ªùng tu tr·ªü n√™n m·ªù m·ªãt, ƒë·∫ßy r·∫´y nh·ªØng c·∫°m b·∫´y v√† th·ª≠ th√°ch. B√≥ng t·ªëi ·ªü ƒë√¢y kh√¥ng ch·ªâ l√† s·ª± v√¥ minh, m√† c√≤n l√† nh·ªØng tham lam, s√¢n h·∫≠n, si m√™, l√† nh·ªØng d·ª•c v·ªçng tr·∫ßn t·ª•c n√≠u k√©o. Khi t√¢m tr√≠ b·ªã che ph·ªß b·ªüi b√≥ng t·ªëi, ng∆∞·ªùi tu d·ªÖ d√†ng l·∫°c l·ªëi, m·∫•t ph∆∞∆°ng h∆∞·ªõng, th·∫≠m ch√≠ t·ª´ b·ªè con ƒë∆∞·ªùng ƒë√£ ch·ªçn. Nh·ªØng l√∫c nh∆∞ v·∫≠y, √°nh s√°ng c·ªßa ch√°nh ph√°p, √°nh s√°ng t·ª´ s·ª± h∆∞·ªõng d·∫´n c·ªßa Minh S∆∞, v√† √°nh s√°ng t·ª´ s·ª± ki√™n ƒë·ªãnh c·ªßa ch√≠nh m√¨nh tr·ªü th√†nh ng·ªçn h·∫£i ƒëƒÉng, gi√∫p ng∆∞·ªùi h√†nh gi·∫£ v∆∞·ª£t qua b√£o t·ªë. Vi·ªác ƒë·ªëi di·ªán v√† chuy·ªÉn h√≥a b√≥ng t·ªëi l√† m·ªôt ph·∫ßn kh√¥ng th·ªÉ thi·∫øu c·ªßa qu√° tr√¨nh tu t·∫≠p, b·ªüi ch·ªâ khi v∆∞·ª£t qua ƒë∆∞·ª£c nh·ªØng gi·ªõi h·∫°n c·ªßa b·∫£n th√¢n, √°nh s√°ng m·ªõi c√≥ th·ªÉ t·ªèa r·∫°ng m·ªôt c√°ch tr·ªçn v·∫πn.</p>

      <h2 id="section-3">Ph√°p m√¥n Minh S∆∞ T·ªãnh Quang: Ngu·ªìn s√°ng d·∫´n l·ªëi</h2>
      <p>Trong Ph√°p m√¥n Minh S∆∞ T·ªãnh Quang, √°nh s√°ng ƒë∆∞·ª£c xem l√† m·ªôt y·∫øu t·ªë c·ªët l√µi, l√† ph∆∞∆°ng ti·ªán ƒë·ªÉ ƒë·∫°t ƒë·∫øn s·ª± thanh t·ªãnh v√† gi√°c ng·ªô. Minh S∆∞, v·ªõi tr√≠ tu·ªá v√† l√≤ng t·ª´ bi v√¥ h·∫°n, ch√≠nh l√† hi·ªán th√¢n c·ªßa √°nh s√°ng, l√† ng∆∞·ªùi th·∫ßy d·∫´n d·∫Øt ch√∫ng sinh tho√°t kh·ªèi v√¥ minh. Ph√°p m√¥n n√†y nh·∫•n m·∫°nh vi·ªác tu t·∫≠p ƒë·ªÉ khai m·ªü "T·ªãnh Quang" ‚Äì √°nh s√°ng thanh t·ªãnh b√™n trong m·ªói ng∆∞·ªùi. Th√¥ng qua vi·ªác th·ª±c h√†nh c√°c ph√°p m√¥n ƒë·∫∑c th√π, ng∆∞·ªùi tu h·ªçc ƒë∆∞·ª£c ti·∫øp nh·∫≠n v√† dung h√≤a √°nh s√°ng t·ª´ Minh S∆∞, t·ª´ ƒë√≥ l√†m tƒÉng tr∆∞·ªüng √°nh s√°ng n·ªôi t√¢m c·ªßa ch√≠nh m√¨nh. S·ª± k·∫øt n·ªëi v·ªõi T·ªãnh Quang kh√¥ng ch·ªâ gi√∫p thanh l·ªçc th√¢n t√¢m m√† c√≤n m·ªü ra nh·ªØng t·∫ßng nh·∫≠n th·ª©c cao h∆°n, ƒë∆∞a ng∆∞·ªùi h√†nh gi·∫£ ƒë·∫øn g·∫ßn h∆°n v·ªõi ch√¢n l√Ω t·ªëi th∆∞·ª£ng.</p>

      <h2 id="section-4">S·ª± s·ªëng m·ªõi: K·∫øt qu·∫£ c·ªßa √°nh s√°ng tu t·∫≠p</h2>
      <p>Khi √°nh s√°ng n·ªôi t√¢m ƒë∆∞·ª£c nu√¥i d∆∞·ª°ng v√† ph√°t tri·ªÉn, n√≥ kh√¥ng ch·ªâ mang l·∫°i s·ª± b√¨nh an, h·∫°nh ph√∫c cho b·∫£n th√¢n m√† c√≤n lan t·ªèa ra xung quanh, ·∫£nh h∆∞·ªüng t√≠ch c·ª±c ƒë·∫øn cu·ªôc s·ªëng c·ªßa nh·ªØng ng∆∞·ªùi kh√°c. S·ª± s·ªëng trong tu t·∫≠p kh√¥ng ch·ªâ l√† s·ª± t·ªìn t·∫°i v·ªÅ m·∫∑t th·ªÉ x√°c, m√† l√† m·ªôt cu·ªôc s·ªëng tr√†n ƒë·∫ßy √Ω nghƒ©a, m·ª•c ƒë√≠ch v√† l√≤ng t·ª´ bi. Ng∆∞·ªùi tu h·ªçc v·ªõi √°nh s√°ng r·ª±c r·ª° trong t√¢m s·∫Ω tr·ªü th√†nh ngu·ªìn c·∫£m h·ª©ng, l√† t·∫•m g∆∞∆°ng s√°ng cho c·ªông ƒë·ªìng. H·ªç s·ªëng m·ªôt cu·ªôc ƒë·ªùi v·ªã tha, c·ªëng hi·∫øn, v√† lu√¥n h∆∞·ªõng ƒë·∫øn s·ª± thi·ªán l√†nh. ƒê√¢y ch√≠nh l√† bi·ªÉu hi·ªán cao nh·∫•t c·ªßa s·ª± s·ªëng ƒë∆∞·ª£c nu√¥i d∆∞·ª°ng b·ªüi √°nh s√°ng c·ªßa tr√≠ tu·ªá v√† t√¨nh y√™u th∆∞∆°ng.</p>

      <p><strong>K·∫øt lu·∫≠n:</strong> H√£y g√¨n gi·ªØ v√† nu√¥i d∆∞·ª°ng √°nh s√°ng trong t√¢m, b·ªüi ƒë√≥ l√† ngu·ªìn g·ªëc c·ªßa m·ªçi s·ª± s·ªëng v√† l√† con ƒë∆∞·ªùng d·∫´n ƒë·∫øn s·ª± gi√°c ng·ªô vi√™n m√£n. √Ånh s√°ng kh√¥ng ch·ªâ l√† bi·ªÉu t∆∞·ª£ng m√† c√≤n l√† nƒÉng l∆∞·ª£ng th·ª±c s·ª±, gi√∫p ch√∫ng ta v∆∞·ª£t qua b√≥ng t·ªëi v√¥ minh, s·ªëng m·ªôt cu·ªôc ƒë·ªùi √Ω nghƒ©a v√† lan t·ªèa y√™u th∆∞∆°ng ƒë·∫øn mu√¥n n∆°i. Ph√°p m√¥n Minh S∆∞ T·ªãnh Quang ch√≠nh l√† chi·∫øc thuy·ªÅn ƒë∆∞a ch√∫ng ta ƒë·∫øn b·∫øn b·ªù gi√°c ng·ªô, n∆°i √°nh s√°ng vƒ©nh c·ª≠u soi r·ªçi m·ªçi ng√≥c ng√°ch c·ªßa t√¢m h·ªìn.</p>
    </div>
  </main>

  <!-- Share Modal -->
  <div id="shareModal" class="fixed inset-0 bg-black/40 flex justify-center items-center z-[9999] hidden">
    <div class="bg-white p-6 rounded-lg shadow-xl w-80">
      <h2 class="text-lg font-bold mb-4 text-gray-800">Chia s·∫ª</h2>
      <div class="flex flex-col gap-3 mb-4">
        <a href="#" id="shareFacebook" target="_blank" class="flex items-center gap-2 text-blue-600 hover:underline p-2 rounded-lg hover:bg-blue-50 transition-colors duration-200">
          <i class="fab fa-facebook-f"></i> Facebook
        </a>
        <button id="copyLinkBtn" class="flex items-center gap-2 text-green-600 hover:underline p-2 rounded-lg hover:bg-green-50 transition-colors duration-200 justify-start">
          <i class="fas fa-link"></i> Sao ch√©p li√™n k·∫øt
        </button>
      </div>
      <button id="closeShare" class="block mx-auto bg-red-500 text-white px-4 py-2 rounded-lg hover:bg-red-600 transition-colors duration-200 shadow-md">ƒê√≥ng</button>
    </div>
  </div>

  <!-- Message Box for copy confirmation -->
  <div id="messageBox" class="fixed bottom-4 right-4 bg-gray-800 text-white px-4 py-2 rounded-lg shadow-lg hidden z-[10000]">
    ƒê√£ sao ch√©p v√†o clipboard!
  </div>

  <!-- Floating Scroll Buttons -->
  <div class="fixed right-4 top-1/2 -translate-y-1/2 flex flex-col gap-2 z-40">
    <button id="scrollTopBtn" class="p-3 bg-yellow-500 text-white rounded-full shadow-lg hover:bg-yellow-600 transition-colors duration-200">
      <i class="fas fa-arrow-up"></i>
    </button>
    <button id="scrollBottomBtn" class="p-3 bg-yellow-500 text-white rounded-full shadow-lg hover:bg-yellow-600 transition-colors duration-200">
      <i class="fas fa-arrow-down"></i>
    </button>
  </div>

  <script type="module">
    // Firebase imports (using modular SDK)
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
    import { getFirestore, doc, getDoc, setDoc, updateDoc, onSnapshot, increment } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

    // Global variables for Firebase config and auth token
    const firebaseConfig = {
      apiKey: "AIzaSyCWv6m3Vw76HPYSRd96U847qViV_EJXZ0Q",
      authDomain: "giaolylikes.firebaseapp.com",
      projectId: "giaolylikes",
      storageBucket: "giaolylikes.firebasestorage.app",
      messagingSenderId: "580748260318",
      appId: "1:580748260318:web:0922e75d385ccab02fa34f"
    };

    const appId = firebaseConfig.projectId;
    const initialAuthToken = null;

    let app, db, auth, userId;
    const ARTICLE_ID = 'mainArticleLikes';
    let currentLikeCount = 0;

    // Log Firebase Config and App ID for debugging
    console.log("Firebase Config:", firebaseConfig);
    console.log("App ID for Firestore paths:", appId);

    // --- Helper Functions (Defined before they are called) ---

    // Message Box Display
    function showMessageBox(message) {
      const messageBox = document.getElementById('messageBox');
      if (messageBox) {
        messageBox.textContent = message;
        messageBox.classList.remove('hidden');
        setTimeout(() => {
          messageBox.classList.add('hidden');
        }, 3000);
      } else {
        console.warn("Message box element not found.");
      }
    }

    // Clear highlights for search functionality
    let lastHighlightedRanges = [];

    function clearHighlights() {
      const content = document.getElementById('content');
      if (content) {
        const highlights = content.querySelectorAll('.highlight');
        highlights.forEach(span => {
          const parent = span.parentNode;
          while (span.firstChild) {
            parent.insertBefore(span.firstChild, span);
          }
          parent.removeChild(span);
        });
        content.normalize();
        lastHighlightedRanges = [];
      }
    }

    // Apply Theme Logic
    const themes = ['default', 'green', 'purple', 'gold'];

    const applyTheme = (themeName) => {
      themes.forEach(theme => {
        document.body.classList.remove(`theme-${theme}`);
      });
      if (themeName !== 'default') {
        document.body.classList.add(`theme-${themeName}`);
      }
      localStorage.setItem('selectedTheme', themeName);
    };

    // Text-to-Speech Helper Functions
    let speechSynthesizer = null;
    let paragraphElements = [];
    let currentParagraphIndex = 0;
    let currentUtterance = null;
    let isSpeechReady = false;

    function initializeParagraphElements() {
      const content = document.getElementById('content');
      if (content) {
        paragraphElements = Array.from(content.querySelectorAll('h1, h2, p'));
      }
    }

    const initSpeechSynthesis = () => {
      speechSynthesizer = window.speechSynthesis;
      const readBtn = document.getElementById('readBtn');
      if (!speechSynthesizer) {
        console.warn("SpeechSynthesis not supported in this browser.");
        showMessageBox("Tr√¨nh duy·ªát c·ªßa b·∫°n kh√¥ng h·ªó tr·ª£ ƒë·ªçc vƒÉn b·∫£n.");
        if (readBtn) readBtn.disabled = true;
        return;
      }

      const checkVoices = () => {
        const voices = speechSynthesis.getVoices();
        console.log("Checking voices. Found:", voices.length, "voices.");
        if (voices.length > 0) {
          isSpeechReady = true;
          console.log("SpeechSynthesis is ready.");
          if (readBtn) readBtn.disabled = false;
          showMessageBox("H·ªá th·ªëng ƒë·ªçc b√†i ƒë√£ s·∫µn s√†ng.");
          return true;
        }
        return false;
      };

      // Initial check
      if (checkVoices()) {
        return;
      }

      // Listen for voices to be loaded
      speechSynthesizer.onvoiceschanged = () => {
        console.log("SpeechSynthesis voices changed event fired.");
        checkVoices(); // Re-check voices when they change
      };

      // Polling mechanism as a fallback if onvoiceschanged doesn't fire or voices are slow to load
      let voiceCheckInterval = setInterval(() => {
        if (checkVoices()) {
          clearInterval(voiceCheckInterval);
        } else {
          console.log("Polling for voices... Still not ready.");
        }
      }, 500);

      // Set a timeout to stop polling after some time if voices don't load
      setTimeout(() => {
        if (!isSpeechReady) {
          clearInterval(voiceCheckInterval);
          console.warn("SpeechSynthesis voices not loaded after timeout.");
          showMessageBox("Kh√¥ng th·ªÉ t·∫£i gi·ªçng ƒë·ªçc. Vui l√≤ng th·ª≠ l·∫°i ho·∫∑c ki·ªÉm tra c√†i ƒë·∫∑t gi·ªçng n√≥i c·ªßa tr√¨nh duy·ªát/h·ªá ƒëi·ªÅu h√†nh.");
          if (readBtn) readBtn.disabled = true;
        }
      }, 15000); // Increased timeout to 15 seconds
    };

    function clearAllHighlightsForSpeech() { // Renamed to avoid conflict with search highlight clear
      paragraphElements.forEach(el => el.classList.remove('highlight-paragraph'));
    }

    function stopReading() {
      const readBtn = document.getElementById('readBtn');
      if (speechSynthesizer && readBtn) {
        speechSynthesizer.cancel();
      }
      clearAllHighlightsForSpeech();
      currentParagraphIndex = 0;
      if (readBtn) readBtn.textContent = 'üîä ƒê·ªçc b√†i';
      console.log("Reading stopped. Resetting button and highlights.");
    }

    function startReading() {
      const readBtn = document.getElementById('readBtn');
      clearAllHighlightsForSpeech();

      if (!isSpeechReady || !speechSynthesizer) {
        showMessageBox("H·ªá th·ªëng ƒë·ªçc b√†i ch∆∞a s·∫µn s√†ng. Vui l√≤ng th·ª≠ l·∫°i sau.");
        console.error("Attempted to start reading when SpeechSynthesis was not ready.");
        if (readBtn) readBtn.disabled = true; // Ensure button is disabled if not ready
        return;
      }

      if (currentParagraphIndex >= paragraphElements.length) {
        console.log("End of article reached. Stopping reading.");
        stopReading();
        return;
      }

      const currentElement = paragraphElements[currentParagraphIndex];
      currentElement.classList.add('highlight-paragraph');
      currentElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
      console.log(`Reading paragraph ${currentParagraphIndex}:`, currentElement.innerText.substring(0, 50) + "...");

      currentUtterance = new SpeechSynthesisUtterance(currentElement.innerText);

      const voices = speechSynthesizer.getVoices();
      const vietnameseVoice = voices.find(voice => voice.lang === 'vi-VN');
      if (vietnameseVoice) {
        currentUtterance.voice = vietnameseVoice;
        console.log("Using Vietnamese voice.");
      } else {
        console.warn("Vietnamese voice not found. Using default voice or first available voice.");
        // Fallback to first available voice if Vietnamese is not found
        if (voices.length > 0) {
            currentUtterance.voice = voices[0];
            console.log("Using first available voice:", voices[0].name);
        } else {
            console.error("No voices available at all, cannot speak.");
            showMessageBox("Kh√¥ng c√≥ gi·ªçng ƒë·ªçc n√†o kh·∫£ d·ª•ng. Vui l√≤ng ki·ªÉm tra c√†i ƒë·∫∑t gi·ªçng n√≥i c·ªßa tr√¨nh duy·ªát/h·ªá ƒëi·ªÅu h√†nh.");
            stopReading();
            return;
        }
      }

      currentUtterance.onend = () => {
        console.log(`Finished paragraph ${currentParagraphIndex}.`);
        currentElement.classList.remove('highlight-paragraph');
        currentParagraphIndex++;
        startReading();
      };

      currentUtterance.onerror = (event) => {
        console.error('SpeechSynthesisUtterance.onerror triggered:', event);
        console.error('Error details:', event.error); // More specific error detail
        stopReading();
        showMessageBox("L·ªói khi ƒë·ªçc b√†i vi·∫øt. Vui l√≤ng th·ª≠ l·∫°i ho·∫∑c ki·ªÉm tra c√†i ƒë·∫∑t gi·ªçng n√≥i c·ªßa tr√¨nh duy·ªát.");
      };

      speechSynthesizer.speak(currentUtterance);
      if (readBtn) readBtn.textContent = '‚è∏Ô∏è T·∫°m d·ª´ng';
    }

    const updateTocActive = () => {
      const tocLinks = [];
      const headers = document.getElementById('content').querySelectorAll('h1, h2');
      headers.forEach((header, i) => {
        const id = 'section-' + i;
        const link = document.querySelector(`#toc a[href="#${id}"]`);
        if (link) {
          tocLinks.push({ id, link, element: header });
        }
      });

      let currentActive = null;
      for (let i = tocLinks.length - 1; i >= 0; i--) {
        const { element, link } = tocLinks[i];
        const rect = element.getBoundingClientRect();
        if (rect.top <= window.innerHeight / 2) {
          currentActive = link;
          break;
        }
      }
      tocLinks.forEach(({ link }) => link.classList.remove('toc-active'));
      if (currentActive) {
        currentActive.classList.add('toc-active');
      }
    };

    const setupLikesListener = () => {
      if (!db) {
        console.warn("Firestore not ready for likes listener.");
        return;
      }
      const articleRef = doc(db, `favorites`, ARTICLE_ID);
      console.log("Firestore listener path (read):", articleRef.path);

      onSnapshot(articleRef, (docSnap) => {
        const likeCountSpan = document.getElementById('likeCount');
        if (docSnap.exists()) {
          currentLikeCount = docSnap.data().likes || 0;
        } else {
          currentLikeCount = 0;
          setDoc(articleRef, { likes: 0 }, { merge: true }).catch(e => console.error("Error initializing likes document:", e));
        }
        if (likeCountSpan) likeCountSpan.textContent = currentLikeCount;
        console.log("Current like count:", currentLikeCount);
      }, (error) => {
        console.error("Error listening to likes:", error);
        showMessageBox("L·ªói khi t·∫£i s·ªë l∆∞·ª£t th√≠ch. Vui l√≤ng ki·ªÉm tra k·∫øt n·ªëi m·∫°ng.");
      });
    };


    // --- Initialize Firebase and handle authentication ---
    const initFirebase = async () => {
      try {
        app = initializeApp(firebaseConfig);
        db = getFirestore(app);
        auth = getAuth(app);

        if (initialAuthToken) {
          await signInWithCustomToken(auth, initialAuthToken);
          console.log("Signed in with custom token.");
        } else {
          await signInAnonymously(auth);
          console.log("Signed in anonymously.");
        }

        onAuthStateChanged(auth, (user) => {
          if (user) {
            userId = user.uid;
            console.log("User ID:", userId);
            setupLikesListener();
          } else {
            console.log("No user is signed in.");
            userId = null;
            setupLikesListener();
          }
        });
      } catch (error) {
        console.error("Error initializing Firebase or signing in:", error);
        showMessageBox("L·ªói kh·ªüi t·∫°o Firebase. Vui l√≤ng ki·ªÉm tra c·∫•u h√¨nh API Key v√† c√°c th√¥ng s·ªë kh√°c.");
      }
    };

    initFirebase();


    // --- DOM Elements ---
    const menuToggle = document.getElementById('menuToggle');
    const mobileMenu = document.getElementById('mobileMenu');
    const closeMenu = document.getElementById('closeMenu');
    const toc = document.getElementById('toc');
    const content = document.getElementById('content');
    const scrollProgress = document.getElementById('scrollProgress');
    const readBtn = document.getElementById('readBtn');
    const likeBtn = document.getElementById('likeBtn');
    const likeCountSpan = document.getElementById('likeCount');
    const shareBtn = document.getElementById('shareBtn');
    const shareModal = document.getElementById('shareModal');
    const closeShare = document.getElementById('closeShare');
    const shareFacebook = document.getElementById('shareFacebook');
    const copyLinkBtn = document.getElementById('copyLinkBtn');
    const messageBox = document.getElementById('messageBox');
    const searchBox = document.getElementById('searchBox');
    const searchBtn = document.getElementById('searchBtn');
    const darkModeToggle = document.getElementById('darkModeToggle');
    const themeSelector = document.getElementById('themeSelector');
    const scrollTopBtn = document.getElementById('scrollTopBtn'); // N√∫t cu·ªôn l√™n
    const scrollBottomBtn = document.getElementById('scrollBottomBtn'); // N√∫t cu·ªôn xu·ªëng


    // --- Event Listeners ---

    if (menuToggle) menuToggle.onclick = () => mobileMenu.classList.remove('hidden');
    if (closeMenu) closeMenu.onclick = () => mobileMenu.classList.add('hidden');

    window.addEventListener('DOMContentLoaded', () => {
      initializeParagraphElements();
      initSpeechSynthesis(); // Call initSpeechSynthesis on DOMContentLoaded
      const headers = content.querySelectorAll('h1, h2');
      const tocLinksArray = [];
      headers.forEach((header, i) => {
        const id = 'section-' + i;
        header.id = id;
        const link = document.createElement('a');
        link.href = '#' + id;
        link.textContent = header.textContent;
        link.className = 'block py-1 px-2 rounded-md hover:bg-yellow-100 transition-colors duration-200';
        if (toc) toc.appendChild(link);
        tocLinksArray.push({ id, link, element: header });

        link.addEventListener('click', (e) => {
          e.preventDefault();
          header.scrollIntoView({ behavior: 'smooth' });
          setTimeout(() => updateTocActive(), 600);
        });
      });
    });

    window.onscroll = () => {
      if (scrollProgress) {
        const scrolled = (window.scrollY / (document.body.scrollHeight - window.innerHeight)) * 100;
        scrollProgress.style.width = scrolled + '%';
      }
      updateTocActive();
    };

    if (readBtn) {
      readBtn.onclick = () => {
        if (!isSpeechReady) {
          showMessageBox("ƒêang t·∫£i gi·ªçng ƒë·ªçc, vui l√≤ng th·ª≠ l·∫°i sau gi√¢y l√°t.");
          return;
        }
        if (speechSynthesizer.speaking && !speechSynthesizer.paused) {
          console.log("Pausing speech.");
          speechSynthesizer.pause();
          readBtn.textContent = '‚ñ∂Ô∏è Ti·∫øp t·ª•c';
          return;
        }
        if (speechSynthesizer.paused) {
          console.log("Resuming speech.");
          speechSynthesizer.resume();
          readBtn.textContent = '‚è∏Ô∏è T·∫°m d·ª´ng';
          return;
        }
        console.log("Starting speech.");
        startReading();
      };
    }

    if (likeBtn) {
      likeBtn.onclick = async (e) => {
        if (!db) {
          console.error("Firestore not initialized. Cannot update likes.");
          showMessageBox("L·ªói: Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn m√°y ch·ªß. Vui l√≤ng ki·ªÉm tra c·∫•u h√¨nh Firebase.");
          return;
        }
        const articleRef = doc(db, `favorites`, ARTICLE_ID);
        console.log("Firestore article likes path (write):", articleRef.path);

        try {
          await setDoc(articleRef, { likes: increment(1) }, { merge: true });
          console.log("Like count updated in Firestore.");
          const heart = document.createElement('div');
          heart.textContent = '‚ù§Ô∏è';
          heart.className = 'rain-heart';
          const rect = likeBtn.getBoundingClientRect();
          heart.style.left = (e.clientX - rect.left + likeBtn.offsetWidth / 2 - 10) + 'px';
          heart.style.top = (e.clientY - rect.top + likeBtn.offsetHeight / 2 - 10) + 'px';
          likeBtn.appendChild(heart);
          setTimeout(() => heart.remove(), 1000);
        } catch (error) {
          console.error("Error updating like count:", error);
          showMessageBox("L·ªói khi th√≠ch b√†i vi·∫øt. Vui l√≤ng ki·ªÉm tra quy t·∫Øc b·∫£o m·∫≠t Firestore v√† k·∫øt n·ªëi.");
        }
      };
    }

    if (shareBtn) {
      shareBtn.onclick = () => {
        if (shareModal) shareModal.classList.remove('hidden');
        const currentUrl = window.location.href;
        if (shareFacebook) shareFacebook.href = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(currentUrl)}`;
      };
    }
    if (closeShare) closeShare.onclick = () => shareModal.classList.add('hidden');
    if (shareModal) {
      shareModal.addEventListener('click', (e) => {
        if (e.target === shareModal) {
          shareModal.classList.add('hidden');
        }
      });
    }

    if (copyLinkBtn) {
      copyLinkBtn.onclick = () => {
        const currentUrl = window.location.href;
        try {
          const tempInput = document.createElement('textarea');
          tempInput.value = currentUrl;
          document.body.appendChild(tempInput);
          tempInput.select();
          document.execCommand('copy');
          document.body.removeChild(tempInput);
          showMessageBox('ƒê√£ sao ch√©p v√†o clipboard!');
          if (shareModal) shareModal.classList.add('hidden');
        } catch (err) {
          console.error('Failed to copy text: ', err);
          showMessageBox('Sao ch√©p th·∫•t b·∫°i. Vui l√≤ng sao ch√©p th·ªß c√¥ng.');
        }
      };
    }

    if (searchBtn) {
      searchBtn.onclick = () => {
        const searchTerm = searchBox.value.trim();
        if (searchTerm === '') {
          clearHighlights();
          return;
        }
        clearHighlights();
        const walker = document.createTreeWalker(content, NodeFilter.SHOW_TEXT, null, false);
        let node;
        let foundCount = 0;
        const rangesToHighlight = [];
        while ((node = walker.nextNode())) {
          const text = node.nodeValue;
          let startIndex = 0;
          while ((startIndex = text.toLowerCase().indexOf(searchTerm.toLowerCase(), startIndex)) !== -1) {
            const range = document.createRange();
            range.setStart(node, startIndex);
            range.setEnd(node, startIndex + searchTerm.length);
            rangesToHighlight.push(range);
            startIndex += searchTerm.length;
            foundCount++;
          }
        }
        if (foundCount > 0) {
          rangesToHighlight.forEach(range => {
            const span = document.createElement('span');
            span.classList.add('highlight');
            range.surroundContents(span);
          });
          lastHighlightedRanges = rangesToHighlight;
          showMessageBox(`T√¨m th·∫•y ${foundCount} k·∫øt qu·∫£.`);
        } else {
          showMessageBox('Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£ n√†o.');
        }
      };
    }

    if (searchBox) {
      searchBox.addEventListener('input', () => {
        if (searchBox.value.trim() === '') {
          clearHighlights();
        }
      });
    }

    if (darkModeToggle) {
      darkModeToggle.onclick = () => {
        document.body.classList.toggle('dark');
        if (document.body.classList.contains('dark')) {
          localStorage.setItem('theme', 'dark');
          darkModeToggle.innerHTML = '‚òÄÔ∏è';
        } else {
          localStorage.setItem('theme', 'light');
          darkModeToggle.innerHTML = 'üåô';
        }
      };
    }

    window.addEventListener('DOMContentLoaded', () => {
      const savedTheme = localStorage.getItem('selectedTheme');
      if (savedTheme) {
        applyTheme(savedTheme);
        if (themeSelector) themeSelector.value = savedTheme;
      } else {
        applyTheme('default');
        if (themeSelector) themeSelector.value = 'default';
      }

      const savedDarkMode = localStorage.getItem('theme');
      if (savedDarkMode === 'dark') {
        document.body.classList.add('dark');
        if (darkModeToggle) darkModeToggle.innerHTML = '‚òÄÔ∏è';
      } else {
        if (darkModeToggle) darkModeToggle.innerHTML = 'üåô';
      }
    });

    if (themeSelector) {
      themeSelector.onchange = (event) => {
        applyTheme(event.target.value);
      };
    }

    window.addEventListener('beforeunload', () => {
      if (speechSynthesizer && speechSynthesizer.speaking) {
        speechSynthesizer.cancel();
      }
    });

    // --- Floating Scroll Buttons Logic ---
    if (scrollTopBtn) {
      scrollTopBtn.onclick = () => {
        window.scrollTo({ top: 0, behavior: 'smooth' });
      };
    }

    if (scrollBottomBtn) {
      scrollBottomBtn.onclick = () => {
        window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
      };
    }

  </script>
</body>

</html>
